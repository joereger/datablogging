<%@ page import="reger.core.db.Db,
                 reger.core.db.Db"%>
<%
/*----------------------------------------------------*/
/*                  Page Config                       */
reger.pageFramework.PageProps pageProps = new reger.pageFramework.PageProps();
pageProps.siteSection=pageProps.PUBLICSITE;
pageProps.isPasswordProtected = false;
pageProps.isLogidRequired=false;
pageProps.isEventidRequired=false;
pageProps.trafficType=reger.Vars.TRAFFICTYPEPUBLICMISC;
pageProps.pathToAppRoot="";
/*----------------------------------------------------*/
%>

<%@ include file="globalheader.jsp" %>

<%
/*----------------------------------------------------*/
/*                  Main Body                         */
        StringBuffer mb = new StringBuffer();
/*----------------------------------------------------*/



mb.append("<table cellpadding=5 cellspacing=2 width=100% border=0>");

mb.append("<tr>");
mb.append("<td valign=top align=left bgcolor=#e6e6e6>");
mb.append("<font face=arial size=-2>");
mb.append("Author");
mb.append("</font>");
mb.append("</td>");
mb.append("<td valign=top align=left bgcolor=#e6e6e6>");
mb.append("<font face=arial size=-2>");
mb.append("Last Login");
mb.append("</font>");
mb.append("</td>");
mb.append("</tr>");


//@todo Should only show authors who can write to at least one log you can see
//-----------------------------------
//-----------------------------------
String[][] rstAuthors= Db.RunSQL("SELECT accountuserid, friendlyname, isactive, lastlogindate FROM accountuser WHERE accountid='"+userSession.getAccount().getAccountid()+"' AND isactive='1' ORDER BY accountuserid ASC");
//-----------------------------------
//-----------------------------------
if (rstAuthors!=null && rstAuthors.length==1){
    try {
        response.sendRedirect(pageProps.pathToAppRoot + "author.log");
        return;
    } catch (Exception e){
        Debug.errorsave(e, "");
    }
}

if (rstAuthors!=null && rstAuthors.length>0){
    for(int i=0; i<rstAuthors.length; i++){

        reger.Accountuser ac = new reger.Accountuser(userSession.getAccount().getAccountid(), Integer.parseInt(rstAuthors[i][0]));

        mb.append("<tr>");
        mb.append("<td valign=top align=left>");
        mb.append("<font face=arial size=-1>");
        mb.append("<a href='author.log?accountuserid="+rstAuthors[i][0]+"'>");
        mb.append("<img src='"+ac.primaryImage(userSession, true)+"' width=35 border=0 align=top>");
        mb.append(rstAuthors[i][1]);
        mb.append("</a>");
        mb.append("</font>");
        mb.append("</td>");


        mb.append("<td valign=top align=left>");
        mb.append("<font face=arial size=-2>");
        String cal = reger.core.TimeUtils.dateformatcompactwithtime(reger.core.TimeUtils.gmttousertime(reger.core.TimeUtils.dbstringtocalendar(rstAuthors[i][3]), userSession.getAccount().getTimezoneid()));
        mb.append(cal);
        mb.append("</font>");
        mb.append("</td>");
        mb.append("</tr>");


    }
}

mb.append("</table>");


%>

<%
/*----------------------------------------------------*/
/*                  Side Column                       */
        StringBuffer sc = new StringBuffer();
/*----------------------------------------------------*/

//sc.append(reger.SideColumn.favorites(pageProps.logProps.logid, pageProps.logProps.megalogname));

%>

<%@ include file="globalfooter.jsp" %>

