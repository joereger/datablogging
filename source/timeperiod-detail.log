<%@ page import="reger.core.db.Db"%>
<%
/*----------------------------------------------------*/
/*                  Page Config                       */
reger.pageFramework.PageProps pageProps = new reger.pageFramework.PageProps();
pageProps.siteSection=pageProps.PUBLICSITE;
pageProps.isPasswordProtected = false;
pageProps.isLogidRequired=false;
pageProps.isEventidRequired=false;
pageProps.trafficType=reger.Vars.TRAFFICTYPEPUBLICMISC;
pageProps.pathToAppRoot="";
/*----------------------------------------------------*/
%>

<%@ include file="globalheader.jsp" %>

<%
/*----------------------------------------------------*/
/*                  Main Body                         */
        StringBuffer mb = new StringBuffer();
/*----------------------------------------------------*/

//Create the timeperiod
int timeperiodid=-1;
if (request.getParameter("timeperiodid")!=null && reger.core.Util.isinteger(request.getParameter("timeperiodid"))) {
    timeperiodid=Integer.parseInt(request.getParameter("timeperiodid"));
}
reger.TimePeriod tpEd = new reger.TimePeriod(timeperiodid, userSession);

//Display a time period
mb.append(reger.ui.BubbleBox.start("Time Period: " + reger.core.Util.truncateString(tpEd.getTitle(), 75), pageProps.pathToAppRoot));

mb.append(reger.ui.BubbleBox.start("Details", pageProps.pathToAppRoot));

//Output the details
mb.append(tpEd.getHtml(false, ""));

mb.append(reger.ui.BubbleBox.end(pageProps.pathToAppRoot));

//List Entries
mb.append(reger.ui.BubbleBox.start("Entries in this Time Period", pageProps.pathToAppRoot));

//-----------------------------------
//-----------------------------------
String[][] rstEnt= Db.RunSQL("SELECT eventid, title, date, comments, megalog.logid FROM event, megalog WHERE event.accountid='"+userSession.getAccount().getAccountid()+"' AND date>='"+reger.core.TimeUtils.dateformatfordb(tpEd.getStartDateGMT())+"' AND date<='"+reger.core.TimeUtils.dateformatfordb(tpEd.getEndDateGMT())+"' AND event.logid=megalog.logid AND "+userSession.getAccountuser().LogsUserCanViewQueryend(userSession.getAccount().getAccountid())+" AND "+reger.Entry.sqlOfLiveEntry+" ORDER BY date DESC");
//-----------------------------------
//-----------------------------------
if (rstEnt!=null && rstEnt.length>0){
	for(int i=0; i<rstEnt.length; i++){
	    mb.append("<br>");
	    mb.append("<font face=arial size=-2>");
	    mb.append(reger.core.TimeUtils.dateformatcompactwithtime(reger.core.TimeUtils.gmttousertime(reger.core.TimeUtils.dbstringtocalendar(rstEnt[i][2]), userSession.getAccount().getTimezoneid())));
	    mb.append("<br>");
        mb.append("<a href='entry.log?eventid="+rstEnt[i][0]+"'>");
        mb.append(rstEnt[i][1]);
        mb.append("</a>");
        mb.append("<br>");
        mb.append(reger.core.Util.truncateString(rstEnt[i][3], 500).replaceAll("<", "&lt;"));
        mb.append("</font>");
        mb.append("<br>");
	}
} else {
    mb.append("<br>");
    mb.append("<font face=arial size=-2>");
    mb.append("None.");
    mb.append("</font>");
}



mb.append(reger.ui.BubbleBox.end(pageProps.pathToAppRoot));

mb.append(reger.ui.BubbleBox.end(pageProps.pathToAppRoot));


%>

<%
/*----------------------------------------------------*/
/*                  Side Column                       */
        StringBuffer sc = new StringBuffer();
/*----------------------------------------------------*/

//sc.append(reger.SideColumn.favorites(pageProps.logProps.logid, pageProps.logProps.megalogname));

%>

<%@ include file="globalfooter.jsp" %>

