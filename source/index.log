<%@ page import="reger.SideColumn,
                 reger.core.db.Db,
                 reger.template.HpTemplateProcessor,
                 reger.template.Template,
                 reger.template.AllTemplatesInSystem,
                 reger.core.db.Db"%>
<%@ page import="reger.AccountCounts"%>

<%
/*----------------------------------------------------*/
/*                  Page Config                       */
reger.pageFramework.PageProps pageProps = new reger.pageFramework.PageProps();
pageProps.siteSection=pageProps.PUBLICSITE;
pageProps.isPasswordProtected = false;
pageProps.trafficType=reger.Vars.TRAFFICTYPEPUBLICHOMEPAGE;
pageProps.pathToAppRoot="";
pageProps.helpText="This is your weblog's home page.  People who visit your weblog won't see this help box or the Logged In bar at the top of the screen.  They'll simply see your weblog.  Prove this to yourself by logging out (top right of screen) and going to your site.<br><br>It's easy to customize the look of your weblog by going to your Admin Tools and choosing the Settings Tab. Try it now.  The bar above this box has a link called My Admin Tools that allows you to get back to the control center of your site.<br><br>Use the links at the top of the screen to toggle between your public site and the tools you use to manage your site.";
/*----------------------------------------------------*/
%>

<%@ include file="globalheader.jsp" %>


<%
/*----------------------------------------------------*/
/*                  Main Body                         */
        StringBuffer mb = new StringBuffer();
/*----------------------------------------------------*/




//If it's not a calendar query or a search, do the dynamic html box thingy
if (request.getParameter("viewmonth")==null && request.getParameter("viewdate")==null && request.getParameter("searchterms")==null){                                                                        

    Template template = AllTemplatesInSystem.getTemplateByTemplateid(userSession.getAccount().getHptemplateid(), Template.TEMPLATETYPEHOMEPAGE);
    String tmp = "";
    if (template!=null){
        tmp = template.getTemplate();
    } else {
        Template tmpTemplate = AllTemplatesInSystem.getTemplateByTemplateid(userSession.getPl().getHptemplateid(), Template.TEMPLATETYPEHOMEPAGE);
        tmp = tmpTemplate.getTemplate();
    }
    //Output the page layout
    mb.append(HpTemplateProcessor.getHtml(tmp, userSession, request, pageProps));

} else {

   //Output a list
    mb.append(reger.htmlListEvents.getList(userSession, -1, reger.core.Util.getCurrentPage(request.getParameter("currentpage")),request.getParameter("viewdate"), request.getParameter("viewmonth"), "index.log", -1, true, request));
}




%>

<%
/*----------------------------------------------------*/
/*                  Side Column                       */
        StringBuffer sc = new StringBuffer();
/*----------------------------------------------------*/

//Get the accountcounts variable
AccountCounts acctCounts = reger.cache.AccountCountCache.get(userSession.getAccount(), userSession.getAccountuser());

//Quick Stats
sc.append(reger.SideColumn.sideColTableStart("Quick Stats"));
sc.append(reger.SideColumn.sideColHeaderRow(""));
//-
StringBuffer qs = new StringBuffer();
qs.append("<a href='authorlist.log'><img src=images/icon-author.gif border=0 align=middle></a> <font face=arial size=-2 class=smallfont> <a href='authorlist.log'>" + acctCounts.getAuthorcount() + " Author");
if (acctCounts.getAuthorcount()==1) {
    qs.append("");
} else {
    qs.append("s");
}
qs.append("</font></a>");
sc.append(reger.SideColumn.sideColContentRow(qs.toString()));
//-
qs.delete(0,qs.length());
qs.append("<a href='index.log'><img src=images/icon-entry.gif border=0 align=middle></a> <font face=arial size=-2 class=smallfont> <a href='index.log'>" + acctCounts.getEntrycount() + " Log ");
if (acctCounts.getEntrycount()==1) {
    qs.append("Entry");
} else {
    qs.append("Entries");
}
qs.append("</font></a>");
sc.append(reger.SideColumn.sideColContentRow(qs.toString()));
//-
qs.delete(0,qs.length());
qs.append("<a href='files.log'><img src=images/imageavailable2.gif border=0 align=middle></a> <font face=arial size=-2 class=smallfont> <a href='files.log'>" + acctCounts.getFilecount() + " File");
if (acctCounts.getFilecount()==1) {
    qs.append("");
} else {
    qs.append("s");
}
qs.append("</font>");
sc.append(reger.SideColumn.sideColContentRow(qs.toString()));
//-
qs.delete(0,qs.length());
qs.append("<a href='locations.log'><img src=images/imageavailable2.gif border=0 align=middle></a> <font face=arial size=-2 class=smallfont> <a href='locations.log'>" + acctCounts.getLocationcount() + " Location");
if (acctCounts.getLocationcount()==1) {
    qs.append("");
} else {
    qs.append("s");
}
qs.append("</font>");
sc.append(reger.SideColumn.sideColContentRow(qs.toString()));
//-
if (userSession.getAccount().getMessagesstatus()==1){
    qs.delete(0,qs.length());
    qs.append("<a href='messages.log'><img src=images/messageavailable.gif border=0 align=middle></a> <font face=arial size=-2 class=smallfont> <a href='messages.log'>" + acctCounts.getMessagecount() + " Message");
    if (acctCounts.getMessagecount()==1) {
        qs.append("");
    } else {
        qs.append("s");
    }
    qs.append("</font>");
    sc.append(reger.SideColumn.sideColContentRow(qs.toString()));
}
//-
qs.delete(0,qs.length());
qs.append("<a href='episodes.log'><img src=images/icon-episode.gif border=0 align=middle></a> <font face=arial size=-2 class=smallfont> <a href='episodes.log'>" + acctCounts.getEpisodecount() + " ");
if (acctCounts.getEpisodecount()==1) {
    qs.append("Episode");
} else {
    qs.append("Episodes");
}
qs.append("</font></a>");
sc.append(reger.SideColumn.sideColContentRow(qs.toString()));
//-
qs.delete(0,qs.length());
qs.append("<a href='graphs.log'><img src=images/imageavailable2.gif border=0 align=middle></a> <font face=arial size=-2 class=smallfont> <a href='graphs.log'>" + acctCounts.getGraphcount() + " Graph");
if (acctCounts.getGraphcount()==1) {
    qs.append("");
} else {
    qs.append("s");
}
qs.append("</font>");
sc.append(reger.SideColumn.sideColContentRow(qs.toString()));
//-
if (userSession.getAccount().getIstimeperiodon()){
    qs.delete(0,qs.length());
    qs.append("<a href='timeperiods.log'><img src=images/timeperiod/tpicon.gif border=0 align=middle></a> <font face=arial size=-2 class=smallfont> <a href='timeperiods.log'>" + acctCounts.getTimeperiodcount() + " Time Period");
    if (acctCounts.getTimeperiodcount()==1) {
        qs.append("");
    } else {
        qs.append("s");
    }
    qs.append("</font>");
    sc.append(reger.SideColumn.sideColContentRow(qs.toString()));
}
//-
if (userSession.getAccount().isPro() && userSession.getAccount().getIssearchmysiteon()==1) {
    qs.delete(0,qs.length());
    qs.append("<a href='savedsearches.log'><img src=images/imageavailable2.gif border=0 align=middle></a> <font face=arial size=-2 class=smallfont> <a href='savedsearches.log'>" + acctCounts.getSavedsearchescount() + " Saved Search");
    if (acctCounts.getSavedsearchescount()==1) {
        qs.append("");
    } else {
        qs.append("es");
    }
    qs.append("</font>");
    sc.append(reger.SideColumn.sideColContentRow(qs.toString()));
}

//-
sc.append(reger.SideColumn.sideColTableEnd("Quick Stats"));



//Hp calendar
if (userSession.getAccount().getHomepagecalendar()==1) {
    String viewmonth = "";
    if (request.getParameter("viewmonth")!=null && !request.getParameter("viewmonth").equals("")){
        viewmonth = request.getParameter("viewmonth");
    } else if (request.getParameter("viewdate")!=null && !request.getParameter("viewdate").equals("")){
        viewmonth = request.getParameter("viewdate");
    }
    sc.append(reger.CalendarHtml.smallcalendar(reger.Vars.CALENDARTYPEEMPTYEVENTFINDER, viewmonth, pageProps.logProps.logid, "index.log", userSession));
}


//Search My Site
if (userSession.getAccount().isPro() && userSession.getAccount().getIssearchmysiteon()==1) {
    sc.append(SideColumn.sideColTableStart("Search My Site"));
    sc.append(SideColumn.sideColHeaderRow("Search My Site"));
    StringBuffer searchBox = new StringBuffer();
    searchBox.append("<form action=search-simplesearch.log method=post>");
    searchBox.append("<input type=hidden name=nextchunktodisplay value=chunk-searchresults>");
    searchBox.append("<input type=hidden name=thischunkuniqueidentifier value=chunk-keywords>");
    searchBox.append("<input type=text name=searchterms value='' size=10 maxlength=49>");
    searchBox.append("<br><input type='submit' value='Search'>");
    searchBox.append("</form>");
    sc.append(SideColumn.sideColContentRow(searchBox.toString()));
    sc.append(SideColumn.sideColTableEnd("Search My Site"));
}

//Email Subscription
if (userSession.getAccount().isPro() && userSession.getAccount().getEmailnewsletter()==1) {
    sc.append(SideColumn.sideColTableStart("Email Subscription"));
    sc.append(SideColumn.sideColHeaderRow("Email Subscription"));
    sc.append(SideColumn.sideColContentRow("<form action=emailsubscription.log method=post><input type=hidden name=action value=addsubscriber><font face=arial class=smallfont size=-1>Enter your email address to receive this site via email.<br><input type=text name=emailaddress size=10 maxlength=49><br><input type='submit' value='Go'></font></form>"));
    sc.append(SideColumn.sideColTableEnd("Email Subscription"));
}

//On This Day
if (userSession.getAccount().isPro()) {
    sc.append(reger.OnThisDay.getHtml(userSession.getAccount().getAccountid(), userSession.getAccountuser().LogsUserCanViewQueryendNoMegalog(userSession.getAccount().getAccountid(), false), true, userSession.getAccount().getTimezoneid(), -1));
}

//Friendly sites
if (userSession.getAccount().isPro() && userSession.getAccount().getFavesiteon()==1) {
    sc.append(SideColumn.sideColTableStart("My Favorite Sites"));
    sc.append(SideColumn.sideColHeaderRow("My Favorite Sites"));

    //-----------------------------------
    //-----------------------------------
    String[][] rstFaveSite= Db.RunSQL("SELECT url, name FROM favesite WHERE accountid='"+ userSession.getAccount().getAccountid() +"' ORDER BY name ASC");
    //-----------------------------------
    //-----------------------------------
    if (rstFaveSite!=null && rstFaveSite.length>0){
        for(int i=0; i<rstFaveSite.length; i++){
            sc.append(SideColumn.sideColContentRow("<font face=arial class=smallfont size=-1><a href=' " + rstFaveSite[i][0] + "' target=_new>" + rstFaveSite[i][1] + "</a></font>"));
        }
    } else {
        sc.append(SideColumn.sideColContentRow("<font face=arial class=smallfont size=-1>None.</font>"));
    }

    sc.append(SideColumn.sideColTableEnd("My Favorite Sites"));
}

//XML Link
sc.append("<!-- XML Start --><a href='rssfeeds.log'><img src='images/xml-newsfeed.png' alt='View this site in XML' border=0></a><!-- XML End -->");

//WAP Link
sc.append("<br>");
sc.append("<!-- WAP Start --><a href='/mobile/home.log'><img src='images/wap-access.png' alt='View this site using a WAP device.' border=0></a><!-- WAP End --><br>");


%>

<%@ include file="globalfooter.jsp" %>

