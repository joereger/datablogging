<%@ page import="reger.SideColumn,
                 reger.core.db.Db,
                 reger.template.HpTemplateProcessor,
                 reger.template.Template,
                 reger.template.AllTemplatesInSystem,
                 reger.core.db.Db,
                 reger.Account"%>
<%@ page import="reger.AccountCounts"%>

<%
/*----------------------------------------------------*/
/*                  Page Config                       */
reger.pageFramework.PageProps pageProps = new reger.pageFramework.PageProps();
pageProps.siteSection=pageProps.PUBLICSITE;
pageProps.isPasswordProtected = false;
pageProps.trafficType=reger.Vars.TRAFFICTYPEPUBLICHOMEPAGE;
pageProps.pathToAppRoot="";
pageProps.helpText="This is your blog's home page.  People who visit your weblog won't see this help box or the Logged In bar at the top of the screen.  They'll simply see your weblog.  Prove this to yourself by logging out (top right of screen) and going to your site.<br><br>It's easy to customize the look of your weblog by going to your Admin Tools and choosing the Settings Tab. Try it now.  The bar above this box has a link called My Admin Tools that allows you to get back to the control center of your site.<br><br>Use the links at the top of the screen to toggle between your public site and the tools you use to manage your site.";
/*----------------------------------------------------*/
%>

<%@ include file="globalheader.jsp" %>


<%
//If it's a customdomain tied to a log then redirect there
int logIdByCustomDomain = Account.findLogidByCustomDomain(userSession.getAccount().getAccountid(), userSession.getUrlSplitter());
if (logIdByCustomDomain>0) {
    response.sendRedirect(pageProps.pathToAppRoot + "logmain"+logIdByCustomDomain+".log");
    return;
}
%>

<%
//If this domain's splash page is on
System.out.println("request.getRequestURI()="+ request.getRequestURI());
if (userSession.getAccount().getIssplashpageon() && (request.getRequestURI().equals("") || request.getRequestURI().equals("/"))) {
    //If this is a root domain call with no other url output the splash
    response.getWriter().print(userSession.getAccount().getSplashpagehtml());
    return;
}
%>


<%
/*----------------------------------------------------*/
/*                  Main Body                         */
        StringBuffer mb = new StringBuffer();
/*----------------------------------------------------*/


//If it's not a calendar query or a search, do the dynamic html box thingy
if (request.getParameter("viewmonth")==null && request.getParameter("viewdate")==null && request.getParameter("searchterms")==null){                                                                        

    Template template = AllTemplatesInSystem.getTemplateByTemplateid(userSession.getAccount().getHptemplateid(), Template.TEMPLATETYPEHOMEPAGE);
    String tmp = "";
    if (template!=null){
        tmp = template.getTemplate();
    } else {
        Template tmpTemplate = AllTemplatesInSystem.getTemplateByTemplateid(userSession.getPl().getHptemplateid(), Template.TEMPLATETYPEHOMEPAGE);
        tmp = tmpTemplate.getTemplate();
    }
    //Output the page layout
    mb.append(HpTemplateProcessor.getHtml(tmp, userSession, request, pageProps));

} else {

   //Output a list
    mb.append(reger.htmlListEvents.getList(userSession, -1, reger.core.Util.getCurrentPage(request.getParameter("currentpage")),request.getParameter("viewdate"), request.getParameter("viewmonth"), "index.log", -1, true, request));
}


%>

<%
/*----------------------------------------------------*/
/*                  Side Column                       */
        StringBuffer sc = new StringBuffer();
/*----------------------------------------------------*/

%>

<%@ include file="globalfooter.jsp" %>

