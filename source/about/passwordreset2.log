<%@ page import="reger.core.db.Db,
                 reger.core.db.Db"%>
<%
/*----------------------------------------------------*/
/*                  Page Config                       */
reger.pageFramework.PageProps pageProps = new reger.pageFramework.PageProps();
pageProps.siteSection=pageProps.MARKETINGSITE;
pageProps.isPasswordProtected = false;
pageProps.trafficType=reger.Vars.TRAFFICTYPEMARKETINGSITEMISC;
pageProps.pathToAppRoot="../";
pageProps.marketingSiteSection = pageProps.MARKETINGSITESECTIONHOME;
/*----------------------------------------------------*/
%>

<%@ include file="../globalheader.jsp" %>



<%
/*----------------------------------------------------*/
/*                  Main Body                         */
        StringBuffer mb = new StringBuffer();
/*----------------------------------------------------*/


String errortext = "";
int accountuserid = -1;
String passphraseanswer = "";
String passphrasequestion = "";

//This page requires a valid username to continue
//-----------------------------------
//-----------------------------------
String[][] rstUser= Db.RunSQL("SELECT accountuserid, passphraseanswer, passphrasequestion FROM accountuser WHERE username='"+reger.core.Util.cleanForSQL(request.getParameter("username"))+"'");
//-----------------------------------
//-----------------------------------
if (rstUser!=null && rstUser.length>0){
    accountuserid = Integer.parseInt(rstUser[0][0]);
    passphraseanswer = rstUser[0][1];
    passphrasequestion = rstUser[0][2];
}  else {
    response.sendRedirect("passwordreset1.log?msg=usernamenotfound");
    return;
}




//Errortext
if (!errortext.equals("")){
    mb.append("<blockquote>");
    mb.append(reger.InfoBox.get(reger.InfoBox.BOXTYPEERROR, pageProps.pathToAppRoot, errortext));
    mb.append("</blockquote>");
}

mb.append("<br><br>");
mb.append("<blockquote>");
mb.append("<font face=arial size=+1>");
mb.append("Your account was found.  Please complete the following information to reset your password:");
mb.append("</font>");
mb.append("<br>");
mb.append("<br>");
mb.append("<form action=passwordreset3.log>");
mb.append("<input type=hidden name=action value=continue>");
mb.append("<input type=hidden name=username value='"+request.getParameter("username")+"'>");
//Begin login table
mb.append("<table cellpadding=10 cellspacing=5 border=0>");
mb.append("<tr>");
mb.append("<td valign=middle align=right>");
mb.append("<font class=mediumfont face=arial size=-1>");
mb.append("<strong>Question:</strong>");
mb.append("</font>");
mb.append("</td>");
mb.append("<td valign=top align=left>");
mb.append("<font face=arial size=+1>");
mb.append(passphrasequestion);
mb.append("</font>");
mb.append("</td>");
mb.append("</tr>");
mb.append("<tr>");
mb.append("<td valign=middle align=right>");
mb.append("<font class=mediumfont face=arial size=-1>");
mb.append("<strong>Answer:</strong>");
mb.append("</font>");
mb.append("</td>");
mb.append("<td valign=top align=left>");
mb.append("<input type='text' name='passphraseanswer' size=10 maxlength=50 style=\"font-size: 18px;\" value=\"\">");
mb.append("</td>");
mb.append("</tr>");
mb.append("<tr>");
mb.append("<td valign=middle align=right>");
mb.append("<font class=mediumfont face=arial size=-1>");
mb.append("<strong>New Password:</strong>");
mb.append("</font>");
mb.append("</td>");
mb.append("<td valign=top align=left>");
mb.append("<input type='password' name='password' size=10 maxlength=50 style=\"font-size: 18px;\" value=\"\">");
mb.append("</td>");
mb.append("</tr>");
mb.append("<tr>");
mb.append("<td valign=middle align=right>");
mb.append("<font class=mediumfont face=arial size=-1>");
mb.append("<strong>New Password Verify:</strong>");
mb.append("</font>");
mb.append("</td>");
mb.append("<td valign=top align=left>");
mb.append("<input type='password' name='verifypassword' size=10 maxlength=50 style=\"font-size: 18px;\" value=\"\">");
mb.append("</td>");
mb.append("</tr>");
mb.append("<tr>");
mb.append("<td valign=top align=left>");
mb.append("<font class=mediumfont face=arial size=-1>");
mb.append("&nbsp;");
mb.append("</font>");
mb.append("</td>");
mb.append("<td valign=top align=left>");
mb.append("<input type='submit' value='Continue'>");
mb.append("</form>");
mb.append("</td>");
mb.append("</tr>");
mb.append("</table>");
//End login table
mb.append("<br><br>");
mb.append("</blockquote>");


%>

<%
/*----------------------------------------------------*/
/*                  Side Column                       */
        StringBuffer sc = new StringBuffer();
/*----------------------------------------------------*/
%>


<%@ include file="../globalfooter.jsp" %>

