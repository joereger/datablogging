<%@ page import="reger.PrivateLabelCounts" %>
<%@ page import="java.util.TreeMap" %>
<%@ page import="java.util.Iterator" %>
<%
    /*----------------------------------------------------*/
/*                  Page Config                       */
    reger.pageFramework.PageProps pageProps = new reger.pageFramework.PageProps();
    pageProps.siteSection = pageProps.MARKETINGSITE;
    pageProps.title = "Community: Tags";
    pageProps.navButtonName = "aboutcommunity-tags";
    pageProps.isPasswordProtected = false;
    pageProps.trafficType = reger.Vars.TRAFFICTYPEMARKETINGSITEMISC;
    pageProps.pathToAppRoot = "../";
    pageProps.marketingSiteSection = pageProps.MARKETINGSITESECTIONCOMMUNITY;
/*----------------------------------------------------*/
%>
<%@ include file="../globalheader.jsp" %>
<%
    /*----------------------------------------------------*/
/*                  Main Body                         */
    StringBuffer mb = new StringBuffer();
/*----------------------------------------------------*/

    mb.append(reger.SideColumn.sideColTableStart("Community Tags"));
    mb.append(reger.SideColumn.sideColHeaderRow("Community Tags"));

    StringBuffer qs = new StringBuffer();
    qs.append("<table cellpadding=0 width=100% cellspacing=0 border=0>");
    qs.append("<tr>");
    qs.append("<td>");
    try {
        PrivateLabelCounts privateLabelCounts = new PrivateLabelCounts(userSession.getPl());
        TreeMap smartTagMap = privateLabelCounts.getTagMap();
        TreeMap sizeMap = privateLabelCounts.getSizeMap();
        if (smartTagMap != null && smartTagMap.size() > 0) {
            String tagId;
            String tag;
            TreeMap tempTagMap = null;
            int minSize = 8;
            int maxSize = 36;
            int fontSizeRange = maxSize-minSize;
            int minNumberOfItems = ((Integer) sizeMap.get((String) sizeMap.firstKey())).intValue();
            int maxNumberOfItems = ((Integer) sizeMap.get((String) sizeMap.lastKey())).intValue();
            Iterator iter = smartTagMap.keySet().iterator();
            while (iter.hasNext()) {
                tag = (String) iter.next();
                tempTagMap = (TreeMap) smartTagMap.get(tag);
                int numberOfItemsInCurrentTag = tempTagMap.size();
                double howFarInNumberOfItemsRange = numberOfItemsInCurrentTag / (maxNumberOfItems - minNumberOfItems);
                double howFarInFontSizeRange = fontSizeRange * howFarInNumberOfItemsRange;
                double finalSizeOfTag = howFarInFontSizeRange + minSize;
                tagId = (String) tempTagMap.get((String)tempTagMap.firstKey());
                qs.append("<a href=community-tag-detail.log?tagid=" + tagId + "&tag=" + tag + " style=font-size:" + finalSizeOfTag + "px; class=SmartTag>" + tag + "</a>");
                qs.append(" ");
            }
        } else {
            qs.append("No Community Tags Found.");
        }
    } catch (Exception e) {
        Debug.errorsave(e, "Exception occurred in community-tags.log");
    }

    qs.append("</td>");
    qs.append("</tr>");
    qs.append("</table>");

    mb.append(reger.SideColumn.sideColContentRow(qs.toString()));
    mb.append(reger.SideColumn.sideColTableEnd("Community Tags"));%>

<%
    /*----------------------------------------------------*/
/*                  Side Column                       */
    StringBuffer sc = new StringBuffer();
/*----------------------------------------------------*/
%>
<%@ include file="../globalfooter.jsp" %>