<%@ page import="reger.PrivateLabelCounts" %>
<%@ page import="java.util.TreeMap" %>
<%@ page import="java.util.Iterator" %>
<%
    /*----------------------------------------------------*/
/*                  Page Config                       */
    reger.pageFramework.PageProps pageProps = new reger.pageFramework.PageProps();
    pageProps.siteSection = pageProps.MARKETINGSITE;
    pageProps.title = "User Data Tags";
    pageProps.navButtonName = "aboutcommunity-tags";
    pageProps.isPasswordProtected = false;
    pageProps.trafficType = reger.Vars.TRAFFICTYPEMARKETINGSITEMISC;
    pageProps.pathToAppRoot = "../";
    pageProps.marketingSiteSection = pageProps.MARKETINGSITESECTIONCOMMUNITY;
/*----------------------------------------------------*/
%>
<%@ include file="../globalheader.jsp" %>
<%
    /*----------------------------------------------------*/
/*                  Main Body                         */
    StringBuffer mb = new StringBuffer();
/*----------------------------------------------------*/

    mb.append("Below are some of the keyword tags our users have assigned to posts, files, photographs, movies, music and more. Click on a few and see what they are labeling.");
    mb.append("<br>");
    mb.append("<br>");

    mb.append(reger.SideColumn.sideColTableStart("Community Tags"));
    mb.append(reger.SideColumn.sideColHeaderRow("Community Tags"));

    StringBuffer qs = new StringBuffer();
    StringBuffer debug = new StringBuffer();
    qs.append("<table cellpadding=0 width=100% cellspacing=0 border=0>");
    qs.append("<tr>");
    qs.append("<td>");
    try {
        PrivateLabelCounts privateLabelCounts = new PrivateLabelCounts(userSession.getPl());
        TreeMap smartTagMap = privateLabelCounts.getTagMap();
        TreeMap sizeMap = privateLabelCounts.getSizeMap();
        if (smartTagMap != null && smartTagMap.size() > 0) {
            String tagId;
            String tag;
            TreeMap tempTagMap = null;
            double minSize = 12;
            double maxSize = 36;
            double fontSizeRange = maxSize-minSize;
            int minNumberOfItems = ((Integer) sizeMap.firstKey()).intValue();
            int maxNumberOfItems = ((Integer) sizeMap.lastKey()).intValue();
            Iterator iter = smartTagMap.keySet().iterator();
            while (iter.hasNext()) {
                tag = (String) iter.next();
                tempTagMap = (TreeMap) smartTagMap.get(tag);
                int numberOfItemsInCurrentTag = tempTagMap.size();
                double howFarInNumberOfItemsRange;
                if (maxNumberOfItems != minNumberOfItems) {
                    if(numberOfItemsInCurrentTag!=minNumberOfItems){
                        double a = numberOfItemsInCurrentTag-minNumberOfItems;
                        double b = maxNumberOfItems-minNumberOfItems;
                        howFarInNumberOfItemsRange = a/b;
                        //howFarInNumberOfItemsRange = (numberOfItemsInCurrentTag-minNumberOfItems)/(maxNumberOfItems-minNumberOfItems);
                    } else {
                        //Just needs to be a very small number... it's as close to the start of the range as possible
                        howFarInNumberOfItemsRange = .01;
                    }
                } else {
                    //All tags are going to be the same size anyway so I can just choose a comfortable size
                    howFarInNumberOfItemsRange = .25;
                }
                double howFarInFontSizeRange = fontSizeRange * howFarInNumberOfItemsRange;
                double finalSizeOfTag = howFarInFontSizeRange + minSize;
                tagId = (String) tempTagMap.get((String)tempTagMap.firstKey());
                qs.append("<a href=community-tag-detail.log?tagid=" + tagId + "&tag=" + tag + " style=font-size:" + finalSizeOfTag + "px; class=SmartTag>" + tag + "</a>");
                qs.append(" ");
            }
        } else {
            qs.append("No Community Tags Found.");
        }
    } catch (Exception e) {
        Debug.errorsave(e, "Exception occurred in community-tags.log");
    }

    qs.append("</td>");
    qs.append("</tr>");
    qs.append("</table>");


    mb.append(reger.SideColumn.sideColContentRow(qs.toString()));
    mb.append(reger.SideColumn.sideColTableEnd("Community Tags"));

    //Debug
    mb.append(debug);

%>

<%
    /*----------------------------------------------------*/
/*                  Side Column                       */
    StringBuffer sc = new StringBuffer();
/*----------------------------------------------------*/
%>
<%@ include file="../globalfooter.jsp" %>