
<%@ page import="java.util.*,
                 javax.naming.Context,
                 javax.naming.InitialContext,
                 reger.Help,
                 reger.core.db.Db" %>

<%
/*----------------------------------------------------*/
/*                  Page Config                       */
reger.pageFramework.PageProps pageProps = new reger.pageFramework.PageProps();
pageProps.siteSection=pageProps.PLADMINSITE;
pageProps.navButtonName = "ploffensivewords";
pageProps.title = "Offensive Words List";
pageProps.isPasswordProtected = true;
pageProps.aclObjectName = "PLADMIN";
pageProps.pathToAppRoot="../";
/*----------------------------------------------------*/
%>

<%@ include file="../globalheader.jsp" %>

<%
/*----------------------------------------------------*/
/*                  Main Body                         */
    StringBuffer mb = new StringBuffer();
/*----------------------------------------------------*/

//Start PLID-choosing SQL
String plidSql = " (pl.plid='"+userSession.getPl().getPlid()+"') ";
if (userSession.getAccountuser().userCanDoAcl("MASTERADMIN", userSession.getAccount().getAccountid())){
    //Essentially this is saying that if you can do masteradmin stuff then you can view all PLs
    plidSql = " (pl.plid>'-1') ";
}
//End PLID-choosing SQL


//Do work of adding
if (pageProps.action.equals("addword")){
    int plid = -1;
    if (request.getParameter("plid")!=null && reger.core.Util.isinteger(request.getParameter("plid"))){
        plid = Integer.parseInt(request.getParameter("plid"));
    }
    String word = "";
    if (request.getParameter("word")!=null && !request.getParameter("word").equals("")){
        word = request.getParameter("word");
    }
    //Validate incoming data
    if (!word.equals("") && plid>0){
        //Make sure the user has permission to work with this plid
        if (userSession.getPl().getPlid()==plid || userSession.getAccountuser().userCanDoAcl("MASTERADMIN", userSession.getAccount().getAccountid())){
            //-----------------------------------
            //-----------------------------------
            int identity = Db.RunSQLInsert("INSERT INTO offensivecontentpl(content, plid) VALUES('"+reger.core.Util.cleanForSQL(word)+"', '"+plid+"')");
            //-----------------------------------
            //-----------------------------------
        }
    }
}

//Do work of deleting
if (pageProps.action.equals("deleteword")){
    int offensivecontentplid = -1;
    if (request.getParameter("offensivecontentplid")!=null && reger.core.Util.isinteger(request.getParameter("offensivecontentplid"))){
        offensivecontentplid = Integer.parseInt(request.getParameter("offensivecontentplid"));
    }
    //Need to go to the database to make sure we have an acceptable plid for this user to edit
    int plid = -1;
    //-----------------------------------
    //-----------------------------------
    String[][] rstCheckPl= Db.RunSQL("SELECT plid FROM offensivecontentpl WHERE offensivecontentplid='"+offensivecontentplid+"'");
    //-----------------------------------
    //-----------------------------------
    if (rstCheckPl!=null && rstCheckPl.length>0){
        plid = Integer.parseInt(rstCheckPl[0][0]);
    }
    //Validate incoming data
    if (offensivecontentplid>0 && plid>0){
        //Make sure the user has permission to work with this plid
        if (userSession.getPl().getPlid()==plid || userSession.getAccountuser().userCanDoAcl("MASTERADMIN", userSession.getAccount().getAccountid())){
            //-----------------------------------
            //-----------------------------------
            int identity = Db.RunSQLInsert("DELETE FROM offensivecontentpl WHERE offensivecontentplid='"+offensivecontentplid+"'");
            //-----------------------------------
            //-----------------------------------
        }
    }
}



mb.append("<!-- Start List -->");
mb.append(reger.ui.BubbleBox.start("Add a New Offensive Word or Phrase", pageProps.pathToAppRoot));
mb.append("<form action=offensivewordslist.log method=post>");
mb.append("<input type=hidden name=action value='addword'>");
mb.append("<table cellpadding=3 cellspacing=0 border=0>");
mb.append("<tr>");
mb.append("<td valign=top>");
mb.append("<select name=plid>");
if (userSession.getAccountuser().userCanDoAcl("MASTERADMIN", userSession.getAccount().getAccountid())){
    //-----------------------------------
    //-----------------------------------
    String[][] rstPl= Db.RunSQL("SELECT plid, plname FROM pl ORDER BY plname ASC");
    //-----------------------------------
    //-----------------------------------
    if (rstPl!=null && rstPl.length>0){
    	for(int i=0; i<rstPl.length; i++){
    	    mb.append("<option value='"+rstPl[i][0]+"'>"+rstPl[i][1]+"</option>");
    	}
    }
} else {
    mb.append("<option value='"+userSession.getPl().getPlid()+"'>"+userSession.getPl().getPlname()+"</option>");
}
mb.append("</select>");
mb.append("</td>");
mb.append("<td valign=top>");
mb.append("<input type=text name=word value=''>");
mb.append("</td>");
mb.append("<td valign=top>");
mb.append("<input type=submit value='Add Word'>");
mb.append("</td>");
mb.append("</tr>");
mb.append("</table>");
mb.append("</form>");
mb.append(reger.ui.BubbleBox.end(pageProps.pathToAppRoot));
mb.append("<!-- End List -->");

mb.append("<!-- Start List -->");
mb.append(reger.ui.BubbleBox.start("Private Label-Specific Offensive Words", pageProps.pathToAppRoot));
mb.append("<table width=100% cellpadding=0 cellspacing=1 border=0>");
mb.append("<tr>");
mb.append("<td bgcolor=#e6e6e6 valign=top align=left>");
mb.append("<font face=arial size=-2 color=#666666>Private Label</font></a></td>");
mb.append("<td bgcolor=#e6e6e6 valign=top align=left>");
mb.append("<font face=arial size=-2 color=#666666>");
mb.append("Word");
mb.append("</font>");
mb.append("</td>");
mb.append("<td bgcolor=#e6e6e6 valign=top align=left>");
mb.append("<font face=arial size=-2 color=#666666>");
mb.append("Action");
mb.append("</font>");
mb.append("</td>");
mb.append("</tr>");
//-----------------------------------
//-----------------------------------
String[][] rstApprovals= Db.RunSQL("SELECT offensivecontentplid, pl.plid, content, plname FROM offensivecontentpl, pl WHERE "+plidSql+" AND offensivecontentpl.plid=pl.plid ORDER BY plname, content ASC");
//-----------------------------------
//-----------------------------------
if (rstApprovals!=null && rstApprovals.length>0){
    for(int i=0; i<rstApprovals.length; i++){
        mb.append("<tr>");
        mb.append("<td bgcolor=#ffffff valign=top align=left>");
        mb.append("<font face=arial size=-2>");
        mb.append(rstApprovals[i][3]);
        mb.append("</font>");
        mb.append("</td>");
        mb.append("<td bgcolor=#ffffff valign=top align=left>");
        mb.append("<font face=arial size=-2>");
        mb.append(rstApprovals[i][2]);
        mb.append("</font>");
        mb.append("</td>");
        mb.append("<td bgcolor=#ffffff valign=top align=left>");
        mb.append("<font face=arial size=-2>");
        mb.append("<a href='offensivewordslist.log?action=deleteword&offensivecontentplid="+rstApprovals[i][0]+"'>");
        mb.append("Delete");
        mb.append("</a>");
        mb.append("</font>");
        mb.append("</td>");
        mb.append("</tr>");
    }
} else {
    mb.append("<tr><td bgcolor=#ffffff valign=top colspan=3>");
    mb.append("<font face=arial size=-2>There are not yet any offensive words defined for this private label.</font>");
    mb.append("</td></tr>");
}
mb.append("</table>");
mb.append(reger.ui.BubbleBox.end(pageProps.pathToAppRoot));
mb.append("<!-- End List -->");



mb.append("<!-- Start List -->");
mb.append(reger.ui.BubbleBox.start("System Default Offensive Words", pageProps.pathToAppRoot));
mb.append("<table width=100% cellpadding=0 cellspacing=1 border=0>");
mb.append("<tr>");
mb.append("<td bgcolor=#e6e6e6 valign=top align=left>");
mb.append("<font face=arial size=-2 color=#666666>Private Label</font></a></td>");
mb.append("<td bgcolor=#e6e6e6 valign=top align=left>");
mb.append("<font face=arial size=-2 color=#666666>");
mb.append("Word");
mb.append("</font>");
mb.append("</td>");
//mb.append("<td bgcolor=#e6e6e6 valign=top align=left>");
//mb.append("<font face=arial size=-2 color=#666666>");
//mb.append("Action");
//mb.append("</font>");
//mb.append("</td>");
mb.append("</tr>");
//-----------------------------------
//-----------------------------------
String[][] rstApprovalsDef= Db.RunSQL("SELECT offensivecontentdefaultsid, content FROM offensivecontentdefaults ORDER BY content ASC");
//-----------------------------------
//-----------------------------------
if (rstApprovalsDef!=null && rstApprovalsDef.length>0){
    for(int i=0; i<rstApprovalsDef.length; i++){
        mb.append("<tr>");
        mb.append("<td bgcolor=#ffffff valign=top align=left>");
        mb.append("<font face=arial size=-2>");
        mb.append("System Default");
        mb.append("</font>");
        mb.append("</td>");
        mb.append("<td bgcolor=#ffffff valign=top align=left>");
        mb.append("<font face=arial size=-2>");
        mb.append(rstApprovalsDef[i][1]);
        mb.append("</font>");
        mb.append("</td>");
        //mb.append("<td bgcolor=#ffffff valign=top align=left>");
        //mb.append("<font face=arial size=-2>");
        //mb.append("<a href='offensivewordslist.log?action=deleteword&offensivecontentplid="+rstApprovalsDef[i][0]+"'>");
        //mb.append("Delete");
        //mb.append("</a>");
        //mb.append("</font>");
        //mb.append("</td>");
        mb.append("</tr>");
    }
} else {
    mb.append("<tr><td bgcolor=#ffffff valign=top colspan=2>");
    mb.append("<font face=arial size=-2>There are not yet any offensive words defined for the system.</font>");
    mb.append("</td></tr>");
}
mb.append("</table>");
mb.append(reger.ui.BubbleBox.end(pageProps.pathToAppRoot));
mb.append("<!-- End List -->");


%>


<%
/*----------------------------------------------------*/
/*                  Side Column                       */
    StringBuffer sc = new StringBuffer();
/*----------------------------------------------------*/

    //sc.append("This is a ");
    //sc.append("side column section.");
%>


<%@ include file="../globalfooter.jsp" %>







