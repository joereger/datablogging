
<%@ page import="java.util.*,
                 reger.core.Util,
                 reger.core.db.Db,
                 reger.core.db.Db" %>

<%
/*----------------------------------------------------*/
/*                  Page Config                       */
reger.pageFramework.PageProps pageProps = new reger.pageFramework.PageProps();
pageProps.siteSection=pageProps.PLADMINSITE;
pageProps.title = "";
pageProps.isPasswordProtected = true;
pageProps.navButtonName = "pleventtype";
//Note: see pladminheader.jsp for explanation on why aclObjectName="ADMINHOME" and not "PLADMIN"
pageProps.aclObjectName = "ADMINHOME";
pageProps.pathToAppRoot="../";
/*----------------------------------------------------*/
%>

<%@ include file="../globalheader.jsp" %>

<%
/*----------------------------------------------------*/
/*                  Main Body                         */
        StringBuffer mb = new StringBuffer();
/*----------------------------------------------------*/


%>
<%@ include file="pladminheader.jsp" %>
<%





if (pageProps.action.equals("add")){
    //Go get a priority
    int newpriority = reger.PlEventtypeOrder.getPriorityForNewField(Integer.parseInt(request.getParameter("plid")));
    //Insert the record
    //-----------------------------------
    //-----------------------------------
    int identity = Db.RunSQLInsert("INSERT INTO pleventtypeid(eventtypeid, plid, priority) VALUES('"+request.getParameter("eventtypeid")+"', '"+plid+"', '"+newpriority+"')");
    //-----------------------------------
    //-----------------------------------
}

if (pageProps.action.equals("setdefault")){
    if (pl!=null){
        if (request.getParameter("eventtypeid")!=null && reger.core.Util.isinteger(request.getParameter("eventtypeid"))){
            pl.setDefaulteventtypeid(Integer.parseInt(request.getParameter("eventtypeid")));
            pl.save();
        }
    }
}

if (pageProps.action.equals("up")){
    //Move it up
    reger.PlEventtypeOrder.moveEventtypeidUp(plid, Integer.parseInt(request.getParameter("pleventtypeid")));
}

if (pageProps.action.equals("down")){
    //Move it up
    reger.PlEventtypeOrder.moveEventtypeidDown(plid, Integer.parseInt(request.getParameter("pleventtypeid")));
}

if (pageProps.action.equals("delete")){
    //Delete the sucker
    //-----------------------------------
    //-----------------------------------
    int count = Db.RunSQLUpdate("DELETE FROM pleventtypeid WHERE pleventtypeid='"+request.getParameter("pleventtypeid")+"'");
    //-----------------------------------
    //-----------------------------------
}





mb.append("<br><br>");

mb.append("<table cellpadding=5 cellspacing=0 border=0 align=center>");
mb.append("<tr>");
mb.append("<td valign=top bgcolor=#ffffff>");
mb.append("<DIV class=greybox>");
//List all event types not currently in this plid
mb.append("<font face=arial size=+1>");
mb.append("System Event Types Not In This PL");
mb.append("</font>");
mb.append("<br>");
mb.append("<font face=arial size=-2>");
//-----------------------------------
//-----------------------------------
String[][] rstNotIn= Db.RunSQL("SELECT megalogtype.eventtypeid, megalogtype.megalogname FROM megalogtype LEFT JOIN pleventtypeid ON pleventtypeid.eventtypeid=megalogtype.eventtypeid AND pleventtypeid.plid='"+request.getParameter("plid")+"' WHERE pleventtypeid.eventtypeid IS NULL AND megalogtype.issystemlogtype='1' ORDER BY megalogtype.megalogname ASC");
//-----------------------------------
//-----------------------------------
if (rstNotIn!=null && rstNotIn.length>0){
	for(int i=0; i<rstNotIn.length; i++){
        mb.append("<DIV class=greybox align=right>");
        mb.append(rstNotIn[i][1]);
        mb.append(" <a href='pleventtype.log?action=add&eventtypeid="+rstNotIn[i][0]+"&plid="+request.getParameter("plid")+"'>");
	    mb.append("Add >>");
	    mb.append("</a>");
	    mb.append("</DIV>");
	}
}
mb.append("</font>");
mb.append("</DIV>");
mb.append("<br><br>");
mb.append("<DIV class=greybox>");
//List all event types not currently in this plid
mb.append("<font face=arial size=+1>");
mb.append("User Event Types Not In This PL");
mb.append("</font>");
mb.append("<br>");
mb.append("<font face=arial size=-2>");
//-----------------------------------
//-----------------------------------
String[][] rstUserNotIn = Db.RunSQL("SELECT megalogtype.eventtypeid, megalogtype.megalogname FROM account, accountuser, megalogtype LEFT JOIN pleventtypeid ON pleventtypeid.eventtypeid=megalogtype.eventtypeid AND pleventtypeid.plid='"+request.getParameter("plid")+"' WHERE pleventtypeid.eventtypeid IS NULL AND megalogtype.issystemlogtype='0' AND megalogtype.accountuserid>'0' AND isprivate='0' AND megalogtype.accountuserid=accountuser.accountuserid AND accountuser.accountid=account.accountid AND account.plid='"+plid+"' ORDER BY megalogtype.megalogname ASC");
//-----------------------------------
//-----------------------------------
if (rstUserNotIn !=null && rstUserNotIn.length>0){
	for(int i=0; i<rstUserNotIn.length; i++){
        mb.append("<DIV class=greybox align=right>");
        mb.append(rstUserNotIn[i][1]);
        mb.append(" <a href='pleventtype.log?action=add&eventtypeid="+rstUserNotIn[i][0]+"&plid="+request.getParameter("plid")+"'>");
	    mb.append("Add >>");
	    mb.append("</a>");
	    mb.append("</DIV>");
	}
}
mb.append("</font>");
mb.append("</DIV>");
mb.append("</td>");
mb.append("<td valign=top>");
//List event types in order for this plid
mb.append("<DIV class=greybox>");
mb.append("<font face=arial size=+1>");
mb.append("This PL's Event Types");
mb.append("</font>");
mb.append("<br>");
mb.append("<font face=arial size=-2>");
//-----------------------------------
//-----------------------------------
String[][] rstCurrent= Db.RunSQL("SELECT pleventtypeid, megalogtype.eventtypeid, megalogname, priority FROM pleventtypeid, megalogtype WHERE pleventtypeid.plid='"+request.getParameter("plid")+"' AND pleventtypeid.eventtypeid=megalogtype.eventtypeid ORDER BY priority ASC");
//-----------------------------------
//-----------------------------------
if (rstCurrent!=null && rstCurrent.length>0){
	for(int i=0; i<rstCurrent.length; i++){
        mb.append("<DIV class=greenbox>");
        mb.append("<a href='pleventtype.log?action=delete&pleventtypeid="+rstCurrent[i][0]+"&plid="+plid+"'>");
	    mb.append("<< Remove");
	    mb.append("</a> ");
        mb.append("<a href='pleventtype.log?action=up&pleventtypeid="+rstCurrent[i][0]+"&plid="+plid+"'>");
	    mb.append("Up");
	    mb.append("</a>");
	    mb.append("&nbsp;");
	    mb.append("<a href='pleventtype.log?action=down&pleventtypeid="+rstCurrent[i][0]+"&plid="+plid+"'>");
	    mb.append("Down");
	    mb.append("</a> ");
        mb.append(rstCurrent[i][2]);
        if (pl!=null && pl.getDefaulteventtypeid()==Integer.parseInt(rstCurrent[i][1])){
            mb.append("&nbsp;");
            //mb.append("<a href='pleventtype.log?action=makedefault&pleventtypeid="+rstCurrent[i][0]+"&plid="+request.getParameter("plid")+"'>");
            mb.append("(Default)");
            //mb.append("</a> ");
        } else {
            mb.append("&nbsp;");
            mb.append("<a href='pleventtype.log?action=setdefault&eventtypeid="+rstCurrent[i][1]+"&plid="+plid+"'>");
            mb.append("Set as Default");
            mb.append("</a> ");
        }
        mb.append("</DIV>");
	}
}
mb.append("</font>");
mb.append("</DIV>");
mb.append("</td>");
mb.append("</tr>");
mb.append("</table>");








/*----------------------------------------------------*/
/*                  Side Column                       */
    StringBuffer sc = new StringBuffer();
/*----------------------------------------------------*/
%>



<%@ include file="../globalfooter.jsp" %>
