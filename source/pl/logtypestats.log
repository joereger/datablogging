
<%@ page import="java.util.*,
                 reger.core.db.Db" %>

<%
/*----------------------------------------------------*/
/*                  Page Config                       */
reger.pageFramework.PageProps pageProps = new reger.pageFramework.PageProps();
pageProps.siteSection=pageProps.PLADMINSITE;
pageProps.title = "Log Type Statistics";
pageProps.isPasswordProtected = true;
pageProps.navButtonName = "pllogtypestats";
pageProps.aclObjectName = "PLADMIN";
pageProps.pathToAppRoot="../";
/*----------------------------------------------------*/
%>

<%@ include file="../globalheader.jsp" %>

<%
/*----------------------------------------------------*/
/*                  Main Body                         */
    StringBuffer mb = new StringBuffer();
/*----------------------------------------------------*/

//Start PLID-choosing SQL
String plidSql = " (pl.plid='"+userSession.getPl().getPlid()+"') ";
if (userSession.getAccountuser().userCanDoAcl("MASTERADMIN", userSession.getAccount().getAccountid())){
    //Essentially this is saying that if you can do masteradmin stuff then you can view all PLs
    plidSql = " (pl.plid>'-1') ";
}
//End PLID-choosing SQL


mb.append("<table cellpadding=0 cellspacing=2 width=100% border=0>");


//Total space in text
long totalspaceintext = 0;
int totalentries = 0;
mb.append("<tr>");
mb.append("<td valign=top bgcolor=#cccccc>");
mb.append("<font face=arial size=-1>");
mb.append("Log Type");
mb.append("</font>");
mb.append("</td>");
mb.append("<td valign=top bgcolor=#cccccc>");
mb.append("<font face=arial size=-1>");
mb.append("Number of Logs");
mb.append("</font>");
mb.append("</td>");
mb.append("</tr>");


//-----------------------------------
//-----------------------------------
String[][] rstEventtypes= Db.RunSQL("SELECT DISTINCT megalogtype.eventtypeid, megalogtype.megalogname FROM megalogtype, pleventtypeid, pl WHERE pl.plid=pleventtypeid.plid AND megalogtype.eventtypeid=pleventtypeid.eventtypeid AND " + plidSql + " ORDER BY megalogtype.megalogname ASC");
//-----------------------------------
//-----------------------------------
if (rstEventtypes!=null && rstEventtypes.length>0){
	for(int i=0; i<rstEventtypes.length; i++){

	    int numberoflogs = 0;
	    //-----------------------------------
	    //-----------------------------------
	    String[][] rstCount= Db.RunSQL("SELECT count(*) FROM megalog, account, pl WHERE megalog.accountid=account.accountid AND account.plid=pl.plid AND " + plidSql + " AND megalog.eventtypeid='"+rstEventtypes[i][0]+"'");
	    //-----------------------------------
	    //-----------------------------------
	    if (rstCount!=null && rstCount.length>0){
	        numberoflogs = Integer.parseInt(rstCount[0][0]);
	    }

	    mb.append("<tr>");
        mb.append("<td valign=top bgcolor=#e6e6e6>");
        mb.append("<font face=arial size=-1>");
        mb.append(rstEventtypes[i][1]);
        mb.append("</font>");
        mb.append("</td>");
        mb.append("<td valign=top bgcolor=#e6e6e6>");
        mb.append("<font face=arial size=-1>");
        mb.append(numberoflogs);
        mb.append("</font>");
        mb.append("</td>");

        mb.append("</tr>");
    }
}



mb.append("</table>");



%>


<%
/*----------------------------------------------------*/
/*                  Side Column                       */
    StringBuffer sc = new StringBuffer();
/*----------------------------------------------------*/

    //sc.append("This is a ");
    //sc.append("side column section.");
%>


<%@ include file="../globalfooter.jsp" %>







