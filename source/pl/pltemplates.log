
<%@ page import="java.util.*,
                 reger.core.Util,
                 reger.template.Template,
                 reger.PrivateLabel,
                 reger.core.db.Db" %>
<%@ page import="reger.core.ValidationException"%>
<%@ page import="reger.InfoBox"%>

<%
/*----------------------------------------------------*/
/*                  Page Config                       */
reger.pageFramework.PageProps pageProps = new reger.pageFramework.PageProps();
pageProps.siteSection=pageProps.PLADMINSITE;
pageProps.title = "";
pageProps.isPasswordProtected = true;
pageProps.navButtonName = "pltemplates";
//Note: see pladminheader.jsp for explanation on why aclObjectName="ADMINHOME" and not "PLADMIN"
pageProps.aclObjectName = "ADMINHOME";
pageProps.pathToAppRoot="../";
/*----------------------------------------------------*/
%>

<%@ include file="../globalheader.jsp" %>

<%
/*----------------------------------------------------*/
/*                  Main Body                         */
        StringBuffer mb = new StringBuffer();
/*----------------------------------------------------*/


%>
<%@ include file="pladminheader.jsp" %>
<%


//Get templateid
int templateid = -1;
if (request.getParameter("templateid")!=null && reger.core.Util.isinteger(request.getParameter("templateid"))){
    templateid = Integer.parseInt(request.getParameter("templateid"));
}


//Get type
int type = -1;
if (request.getParameter("type")!=null && reger.core.Util.isinteger(request.getParameter("type"))){
    type = Integer.parseInt(request.getParameter("type"));
}

//Load the template
Template template = reger.template.AllTemplatesInSystem.getTemplateByTemplateid(templateid, type);

String errortext = "";

//Use this one sets the
//reger.UserSession userSession;
if (pageProps.action.equals("usethisone")){
    if (template!=null){
        if (template.getType()==Template.TEMPLATETYPESITE){
            pl.setPublicsitetemplateid(template.getTemplateid());
        } else if (template.getType()==Template.TEMPLATETYPEENTRYLIST){
            pl.setEntlisttemplateid(template.getTemplateid());
        } else if (template.getType()==Template.TEMPLATETYPEHOMEPAGE){
            pl.setHptemplateid(template.getTemplateid());
        } else if (template.getType()==Template.TEMPLATETYPEMARKETINGSITE){
            pl.setMarketingsitetemplateid(template.getTemplateid());
        } else if (template.getType()==Template.TEMPLATETYPEMARKETINGHOMEPAGE){
            pl.setMarketingsitehptemplateid(template.getTemplateid());
        }  else if (template.getType()==Template.TEMPLATETYPEPLUSER){
            pl.setPlusertemplateid(template.getTemplateid());
        }
        try{
            pl.save();
            reger.template.AllTemplatesInSystem.refresh(template.getTemplateid());
            pl.refresh();
            userSession.getAccount().refresh();

        } catch (ValidationException vex){
            errortext = vex.getErrorsAsSingleString();
        }
    }
}


//Edit is simply a redirect to the edit screen
if (pageProps.action.equals("edit")){
    response.sendRedirect("settings-template-edit.log?templateid=" + templateid+ "&type=" + request.getParameter("type")+"&returnurl=" + request.getParameter("returnurl") + "&plid="+plid);
    return;
}

//Delete is simply a redirect to the edit screen
if (pageProps.action.equals("delete")){
    response.sendRedirect("settings-template-delete.log?templateid=" + templateid + "&plid="+plid);
    return;
}

//Edit is simply a redirect to the edit screen
if (pageProps.action.equals("export")){
    response.sendRedirect("settings-template-export.log?templateid=" + templateid + "&plid="+plid);
    return;
}


mb.append(reger.core.Util.popup());


if (!errortext.equals("")){
    mb.append(InfoBox.get(InfoBox.BOXTYPEERROR, pageProps.pathToAppRoot, errortext));
}


mb.append("<br>");
mb.append("<br>");

//Start PL Templates  -------
//Spacer
mb.append("<br>");
mb.append("<img src=images/clear.gif width=1 height=1>");
mb.append("<br>");

//Site Template
//reger.UserSession userSession;
Template activeTemplate = reger.template.AllTemplatesInSystem.getTemplateByTemplateid(pl.getPublicsitetemplateid(), Template.TEMPLATETYPESITE);
Template[] siteUserTemplates = null;
Template[] siteSystemTemplates = reger.template.AllTemplatesInSystem.getSystemTemplatesByType(Template.TEMPLATETYPESITE);
mb.append(reger.template.TemplateHtml.getBox(activeTemplate, siteUserTemplates, siteSystemTemplates, "PL Default Site Template", "This allows you to define the defauls template that users will have when they sign up for an account.", pl.getPlid(), -1, Template.TEMPLATETYPESITE, "pltemplates.log", "settings-template-edit.log", true, true, true, true, "templateid", false));

//Spacer
mb.append("<br>");
mb.append("<img src=images/clear.gif width=1 height=1>");
mb.append("<br>");

//Entry Template
//reger.UserSession userSession;
Template activeEntryListTemplate = reger.template.AllTemplatesInSystem.getTemplateByTemplateid(pl.getEntlisttemplateid(), Template.TEMPLATETYPEENTRYLIST);
Template[] entUserTemplates = null;
Template[] entSystemTemplates = reger.template.AllTemplatesInSystem.getSystemTemplatesByType(Template.TEMPLATETYPEENTRYLIST);
mb.append(reger.template.TemplateHtml.getBox(activeEntryListTemplate, entUserTemplates, entSystemTemplates, "PL Default Entry List Templates", "This template governs entries on user sites as they appear in a list on the homepage.", pl.getPlid(), -1, Template.TEMPLATETYPEENTRYLIST, "pltemplates.log", "settings-template-edit.log", true, true, true, true, "templateid", false));

//Spacer
mb.append("<br>");
mb.append("<img src=images/clear.gif width=1 height=1>");
mb.append("<br>");

//Hp Template
//reger.UserSession userSession;
Template activeHpTemplate = reger.template.AllTemplatesInSystem.getTemplateByTemplateid(pl.getHptemplateid(), Template.TEMPLATETYPEHOMEPAGE);
Template[] hpUserTemplates = null;
Template[] hpSystemTemplates = reger.template.AllTemplatesInSystem.getSystemTemplatesByType(Template.TEMPLATETYPEHOMEPAGE);
mb.append(reger.template.TemplateHtml.getBox(activeHpTemplate, hpUserTemplates, hpSystemTemplates, "PL Default Site Homepage Templates", "This template controls how the homepage of your users' sites operates.", pl.getPlid(), -1, Template.TEMPLATETYPEHOMEPAGE, "pltemplates.log", "settings-template-edit.log", true, true, true, true, "templateid", false));



//Spacer
mb.append("<br>");
mb.append("<img src=images/clear.gif width=1 height=1>");
mb.append("<br>");

//PL User Template
//reger.UserSession userSession;
Template activePlUserTemplate = reger.template.AllTemplatesInSystem.getTemplateByTemplateid(pl.getPlusertemplateid(), Template.TEMPLATETYPEPLUSER);
Template[] plUserTemplates = null;
Template[] plUserSystemTemplates = reger.template.AllTemplatesInSystem.getSystemTemplatesByType(Template.TEMPLATETYPEPLUSER);
mb.append(reger.template.TemplateHtml.getBox(activePlUserTemplate, plUserTemplates, plUserSystemTemplates, "PL User Wrapper Template", "This template wraps around all user sites so that you can put your logo/look&feel around all of their sites.  You then determine whether this is applied to Pro accounts in the Settings tab.", pl.getPlid(), -1, Template.TEMPLATETYPEPLUSER, "pltemplates.log", "settings-template-edit.log", true, true, true, true, "templateid", false));



//Spacer
mb.append("<br>");
mb.append("<img src=images/clear.gif width=1 height=1>");
mb.append("<br>");

//Marketing Site Template
//reger.UserSession userSession;
Template activeMktgSiteTemplate = reger.template.AllTemplatesInSystem.getTemplateByTemplateid(pl.getMarketingsitetemplateid(), Template.TEMPLATETYPEMARKETINGSITE);
Template[] mktgSiteUserTemplates = null;
Template[] mktgSiteSystemTemplates = reger.template.AllTemplatesInSystem.getSystemTemplatesByType(Template.TEMPLATETYPEMARKETINGSITE);
mb.append(reger.template.TemplateHtml.getBox(activeMktgSiteTemplate, mktgSiteUserTemplates, mktgSiteSystemTemplates, "PL Marketing Site Template", "This template controls how the marketing site operates.", pl.getPlid(), -1, Template.TEMPLATETYPEMARKETINGSITE, "pltemplates.log", "settings-template-edit.log", true, true, true, true, "templateid", false));

//Spacer
mb.append("<br>");
mb.append("<img src=images/clear.gif width=1 height=1>");
mb.append("<br>");

//Marketing Site Template
//reger.UserSession userSession;
Template activeMktgHpTemplate = reger.template.AllTemplatesInSystem.getTemplateByTemplateid(pl.getMarketingsitehptemplateid(), Template.TEMPLATETYPEMARKETINGHOMEPAGE);
Template[] mktgHpUserTemplates = null;
Template[] mktgHpSystemTemplates = reger.template.AllTemplatesInSystem.getSystemTemplatesByType(Template.TEMPLATETYPEMARKETINGHOMEPAGE);
mb.append(reger.template.TemplateHtml.getBox(activeMktgHpTemplate, mktgHpUserTemplates, mktgHpSystemTemplates, "PL Marketing Homepage Template", "This template controls how the homepage of the marketing site.", pl.getPlid(), -1, Template.TEMPLATETYPEMARKETINGHOMEPAGE, "pltemplates.log", "settings-template-edit.log", true, true, true, true, "templateid", false));

//Spacer
mb.append("<br>");
mb.append("<img src=images/clear.gif width=1 height=1>");
mb.append("<br>");
//End PL Templates  -------





/*----------------------------------------------------*/
/*                  Side Column                       */
    StringBuffer sc = new StringBuffer();
/*----------------------------------------------------*/
%>



<%@ include file="../globalfooter.jsp" %>
