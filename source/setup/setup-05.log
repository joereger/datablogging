<%@ page import="reger.core.db.DbConfig,
                 reger.core.db.Db,
                 reger.MegaLogType,
                 reger.Account,
                 reger.core.Util"%>
<%
//Only do this page if we have an invalid database connection.
//Otherwise, anybody's going to be able to reset the database
//configuration whenever they want. Which isn't cool.
if (!DbConfig.haveValidConfig()){
    response.sendRedirect("setup-01.log");
    return;
}
if (!reger.core.dbupgrade.RequiredDatabaseVersion.havecorrectversion){
    response.sendRedirect("setup-02.log");
    return;
}
//-----------------------------------
//-----------------------------------
String[][] rstUser= Db.RunSQL("SELECT accountuser.accountuserid FROM accountuser, accountuseraclgroup WHERE accountuser.accountuserid=accountuseraclgroup.accountuserid AND accountuseraclgroup.aclgroupid='"+reger.acl.AllAclGroups.getAclGroupByName("LOEAdmin").getAclgroupid()+"'");
//-----------------------------------
//-----------------------------------
if (rstUser!=null && rstUser.length>0){

} else {
    //There is not yet a user with LOEAdmin permissions in the database.
    response.sendRedirect("setup-03.log");
    return;
}
%>




<%@ include file="setup-header.jsp" %>
<%
if (request.getParameter("msg")!=null && request.getParameter("msg").equals("issetupadminusernotvalid")){
    out.print("<font face=arial size=+3 color=#ff0000>You can't use /setup to configure your server.  Use the already-existing admin account and go to LOE Admin.  Thanks.</font>");    
} else {
    out.print("<font face=arial size=+3 color=#cccccc>Congratulations!  Setup is Finished!</font>");
}
%>


<br><br>
<%out.print(reger.ui.ShadowBox.start("../"));%>
<font face=arial size=-1 color=#cccccc><a href='../index.log'>Click here to go to the homepage where you can log in using the administrator account.</a></font>
<%out.print(reger.ui.ShadowBox.end("../"));%>
<%@ include file="setup-footer.jsp" %>

