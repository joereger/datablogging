<%@ page import="reger.AccountCounts" %>
<%@ page import="java.util.HashMap" %>
<%@ page import="java.util.Iterator" %>
<%@ page import="java.util.TreeMap"%>
<%@ page import="java.math.BigDecimal"%>
<%
    /*----------------------------------------------------*/
/*                  Page Config                       */
    reger.pageFramework.PageProps pageProps = new reger.pageFramework.PageProps();
    pageProps.siteSection = reger.pageFramework.PageProps.PUBLICSITE;
    pageProps.isPasswordProtected = false;
    pageProps.isLogidRequired = false;
    pageProps.isEventidRequired = false;
    pageProps.trafficType = reger.Vars.TRAFFICTYPEPUBLICMISC;
    pageProps.pathToAppRoot = "";
/*----------------------------------------------------*/
%>

<%@ include file="globalheader.jsp" %>

<%
    /*----------------------------------------------------*/
/*                  Main Body                         */
    StringBuffer mb = new StringBuffer();
/*----------------------------------------------------*/

    mb.append(reger.SideColumn.sideColTableStart("Smart Tags"));
    mb.append(reger.SideColumn.sideColHeaderRow("Smart Tags"));

    StringBuffer qs = new StringBuffer();
    qs.append("<table cellpadding=0 width=100% cellspacing=0 border=0>");
    qs.append("<tr>");
    qs.append("<td>");
    try {
        AccountCounts acctCounts = reger.cache.AccountCountCache.get(userSession.getAccount(), userSession.getAccountuser());
        TreeMap smartTagMap = acctCounts.getSmartTagMap();
        TreeMap sizeMap = acctCounts.getSizeMap();

        if (smartTagMap != null && smartTagMap.size() > 0) {
            String tagId;
            String tag;
            TreeMap tempTagMap = null;
            double minSize = 12;
            double maxSize = 36;
            double fontSizeRange = maxSize-minSize;
            int minNumberOfItems = ((Integer) sizeMap.firstKey()).intValue();
            int maxNumberOfItems = ((Integer) sizeMap.lastKey()).intValue();
            Iterator iter = smartTagMap.keySet().iterator();
            while (iter.hasNext()) {
                tag = (String) iter.next();
                tempTagMap = (TreeMap) smartTagMap.get(tag);
                int numberOfItemsInCurrentTag = tempTagMap.size();
                double howFarInNumberOfItemsRange;
                if (maxNumberOfItems != minNumberOfItems) {
                    if(numberOfItemsInCurrentTag!=minNumberOfItems){
                        double a = numberOfItemsInCurrentTag-minNumberOfItems;
                        double b = maxNumberOfItems-minNumberOfItems;
                        howFarInNumberOfItemsRange = a/b;
                        //howFarInNumberOfItemsRange = (numberOfItemsInCurrentTag-minNumberOfItems)/(maxNumberOfItems-minNumberOfItems);
                    } else {
                        //Just needs to be a very small number... it's as close to the start of the range as possible
                        howFarInNumberOfItemsRange = .01;
                    }
                } else {
                    //All tags are going to be the same size anyway so I can just choose a comfortable size
                    howFarInNumberOfItemsRange = .25;
                }
                double howFarInFontSizeRange = fontSizeRange * howFarInNumberOfItemsRange;
                double finalSizeOfTag = howFarInFontSizeRange + minSize;
                tagId = (String) tempTagMap.get((String)tempTagMap.firstKey());
                qs.append("<a href=tag-detail.log?tagid=" + tagId + "&tag=" + tag + " style=font-size:" + finalSizeOfTag + "px; class=SmartTag>" + tag + "</a>");
                qs.append(" ");
            }
        } else {
            qs.append("No Tags Found.");
        }
    } catch (Exception e) {
        Debug.errorsave(e, "Exception occurred in tags.log");
    }

    qs.append("</td>");
    qs.append("</tr>");
    qs.append("</table>");

   mb.append(reger.SideColumn.sideColContentRow(qs.toString()));
   mb.append(reger.SideColumn.sideColTableEnd("Smart Tags"));
%>

<%
    /*----------------------------------------------------*/
/*                  Side Column                       */
    StringBuffer sc = new StringBuffer();
/*----------------------------------------------------*/


%>

<%@ include file="globalfooter.jsp" %>