<%@ page import="reger.core.db.Db"%>
<%
/*----------------------------------------------------*/
/*                  Page Config                       */
reger.pageFramework.PageProps pageProps = new reger.pageFramework.PageProps();
pageProps.siteSection=pageProps.MOBILEPUBLIC;
pageProps.isPasswordProtected = false;
pageProps.aclObjectName = "MOBILE";
pageProps.trafficType=reger.Vars.TRAFFICTYPEPUBLICHOMEPAGE;
pageProps.pathToAppRoot="../";
/*----------------------------------------------------*/
%>

<%@ include file="../globalheader.jsp" %>

<%
/*----------------------------------------------------*/
/*                  Main Body                         */
        StringBuffer mb = new StringBuffer();
/*----------------------------------------------------*/

// set content type for wireless data
response.setContentType("text/vnd.wap.wml");

// write the data
mb.append("<?xml version=\"1.0\"?>");
mb.append("<!DOCTYPE wml PUBLIC \"-//WAPFORUM//DTD WML 1.1//EN\"");
mb.append(" \"http://www.wapforum.org/DTD/wml_1.1.xml\">");
mb.append("<wml>");
mb.append("<card title=\"Entry\">");

int pagenum = 1;
if (request.getParameter("pagenum")!=null && reger.core.Util.isinteger(request.getParameter("pagenum"))){
    pagenum = Integer.parseInt(request.getParameter("pagenum"));
}

int charsPerPage = 1000;

//-----------------------------------
//-----------------------------------
String[][] rstEventList= Db.RunSQL("SELECT eventid, title, comments FROM event, megalog WHERE event.accountid='"+ userSession.getAccount().getAccountid() +"' AND event.logid=megalog.logid AND "+userSession.getAccountuser().LogsUserCanViewQueryend(userSession.getAccount().getAccountid())+" AND event.eventid='"+request.getParameter("eventid")+"' LIMIT 0,1");
//-----------------------------------
//-----------------------------------
if (rstEventList!=null && rstEventList.length>0){
	for(int i=0; i<rstEventList.length; i++){
	    mb.append("<p>");
		mb.append(rstEventList[i][1]);
	    mb.append("</p>");
	    mb.append("<p>");
		mb.append("---");
	    mb.append("</p>");

	    //Get the whole entry
	    String wholeEntry = rstEventList[i][2];

	    //Set the start and end
	    int start = 0;
	    int end = wholeEntry.length();
	    if (wholeEntry.length()>=charsPerPage){
            start = (pagenum * charsPerPage) - (charsPerPage);
            end = (pagenum * charsPerPage);
            if (end>wholeEntry.length()){
                end = wholeEntry.length();
            }
            if (start>wholeEntry.length() || start>end){
                start = end - charsPerPage;
                if (start<0){
                    start = 0;
                }
            }
        }

	    //Do the substringing
	    String entryToDisplay = reger.core.Util.truncateString(wholeEntry, charsPerPage);
	    try{
	        entryToDisplay = wholeEntry.substring(start, end);
        } catch (Exception e){
            Debug.errorsave(e, "", "Problem in /mobile/entryview.log.");
        }


	    mb.append("<p>");
		mb.append(entryToDisplay);
	    mb.append("</p>");

	    if (wholeEntry.length()>=charsPerPage){
            mb.append("<p>");
            mb.append("<a href=\"entryview.log?eventid="+request.getParameter("eventid")+"&pagenum="+(pagenum+1)+"\">More</a>");
            mb.append("</p>");
        }
	}
} else {
    mb.append("<p>");
    mb.append("No Entries Found.");
    mb.append("</p>");
}


mb.append("</card>");
mb.append("</wml>");

%>

<%
/*----------------------------------------------------*/
/*                  Side Column                       */
        StringBuffer sc = new StringBuffer();
/*----------------------------------------------------*/
%>

<%@ include file="../globalfooter.jsp" %>

