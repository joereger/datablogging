<%@ page import="reger.core.db.Db"%>
<%
/*----------------------------------------------------*/
/*                  Page Config                       */
reger.pageFramework.PageProps pageProps = new reger.pageFramework.PageProps();
pageProps.siteSection=pageProps.PUBLICSITE;
pageProps.isPasswordProtected = false;
pageProps.isLogidRequired=false;
pageProps.isEventidRequired=false;
pageProps.trafficType=reger.Vars.TRAFFICTYPEPUBLICMISC;
pageProps.pathToAppRoot="";
/*----------------------------------------------------*/
%>

<%@ include file="globalheader.jsp" %>

<%
/*----------------------------------------------------*/
/*                  Main Body                         */
        StringBuffer mb = new StringBuffer();
/*----------------------------------------------------*/

//Get the accountuseridtarget
int accountuseridtarget = -1;
if (request.getParameter("accountuseridtarget")!=null && reger.core.Util.isinteger(request.getParameter("accountuseridtarget"))){
    accountuseridtarget = Integer.parseInt(request.getParameter("accountuseridtarget"));

    //Set the session var
    session.setAttribute( "accountuseridtarget", String.valueOf(accountuseridtarget));
}

//Create an accountuser object for the target
reger.Accountuser autarget = new reger.Accountuser(accountuseridtarget, true);

//Add the friend
boolean success = false;
if (pageProps.action.equals("addfriend")){

    if (userSession.getAccountuser().userAuthenticate(request.getParameter("username"), request.getParameter("password"))){
        //Add the friend
        userSession.getAccountuser().addFriend(accountuseridtarget);
        success=true;
    }

}




//Start page
mb.append("<br><br>");



//error message
if (!success && pageProps.action.equals("addfriend")){
    mb.append(reger.InfoBox.get(reger.InfoBox.BOXTYPEERROR, pageProps.pathToAppRoot, "I'm sorry, your account couldn't be found with the information you provided.  Please try again."));
}

if (pageProps.action.equals("addfriend") && success){

    mb.append(reger.InfoBox.get(reger.InfoBox.BOXTYPECOMPLETE, pageProps.pathToAppRoot, "Success! The friendship has been created!"));


    //Show the link between the two friends
    mb.append("<table cellpadding=5 cellspacing=8 border=0 width=80% align=center bgcolor=#e6e6e6>");

    mb.append("<tr>");
    mb.append("<td valign=top align=center bgcolor=#ffffff>");
    mb.append("<font face=arial size=+1>");
    mb.append(autarget.getFriendlyname());
    mb.append("</font>");
    mb.append("<br>");
    mb.append("<img src='"+autarget.primaryImage(pageProps.pathToAppRoot, true)+"' border=0 width=100>");
    mb.append("</td>");
    mb.append("<td valign=middle bgcolor=#ffffff nowrap>");
    mb.append("<font face=arial size=+3>");
    mb.append("&lt; -- Friends -- &gt;");
    mb.append("</font>");
    mb.append("</td>");
    mb.append("<td valign=top align=center bgcolor=#ffffff>");
    mb.append("<font face=arial size=+1>");
    mb.append(userSession.getAccountuser().getFriendlyname());
    mb.append("</font>");
    mb.append("<br>");
    mb.append("<img src='"+userSession.getAccountuser().primaryImage(pageProps.pathToAppRoot, true)+"' border=0 width=100>");
    mb.append("</td>");
    mb.append("</tr>");

    mb.append("</table>");
} else {
    //Display the default form
    mb.append("<img src='"+autarget.primaryImage(pageProps.pathToAppRoot, true)+"' border=0 align=left width=100>");
    mb.append("<font face=arial size=+2>");
    mb.append("Make "+autarget.getFriendlyname()+" Your Friend");
    mb.append("</font>");
    mb.append("<br>");
    mb.append("<font face=arial size=-2>");
    mb.append("This page creates a friend association between "+autarget.getFriendlyname()+" and you.  To do this we need to know who you are so we need you to log in.  If you don't have an account you can create one and your friend will automatically be associated with you.");
    mb.append("</font>");

    mb.append("<br clear=all>");

    mb.append("<form action=friendassociateend.log method=post>");
    mb.append("<input type=hidden name=action value=addfriend>");
    mb.append("<input type=hidden name=accountuseridtarget value="+accountuseridtarget+">");
    mb.append("<table cellpadding=5 cellspacing=8 border=0 width=80% align=center bgcolor=#e6e6e6>");

    mb.append("<tr>");
    mb.append("<td valign=top bgcolor=#ffffff>");

    //Account details table

    mb.append("<table cellpadding=3 cellspacing=2 border=0 width=100% align=center bgcolor=#ffffff>");


    mb.append("<tr>");
    mb.append("<td valign=top align=left bgcolor=#e6e6e6 colspan=2>");
    mb.append("<font face=arial size=+1>");
    mb.append("<strong>");
    mb.append("Please Verify Your Log In:");
    mb.append("</strong>");
    mb.append("</font>");
    mb.append("</td>");
    mb.append("</tr>");


    mb.append("<tr>");
    mb.append("<td valign=top align=left colspan=2>");
    mb.append("<font face=arial size=-2>");
    mb.append("<strong>");
    mb.append("To be friends with "+autarget.getFriendlyname()+" you must have a site enabled on the same technology platform.  If you do, enter your url, username and password below.  This is done to create the friendship with you.  Your username and password are not shared with "+autarget.getFriendlyname()+".  They are required because you don't have an account on "+autarget.getFriendlyname()+"'s site.");
    mb.append("</strong>");
    mb.append("</font>");
    mb.append("</td>");
    mb.append("</tr>");


    mb.append("<tr>");
    mb.append("<td valign=top align=right>");
    mb.append("<font face=arial size=-1>");
    mb.append("<strong>");
    mb.append("Username:");
    mb.append("</strong>");
    mb.append("</font>");
    mb.append("<br>");
    mb.append("<font face=arial size=-2>");
    mb.append("This is the username that you use to log in to your site.");
    mb.append("</font>");
    mb.append("</td>");
    mb.append("<td valign=top align=left>");
    mb.append("<input type=text name=username size=15 maxlength=50>");
    mb.append("</td>");
    mb.append("</tr>");


    mb.append("<tr>");
    mb.append("<td valign=top align=right>");
    mb.append("<font face=arial size=-1>");
    mb.append("<strong>");
    mb.append("Password:");
    mb.append("</strong>");
    mb.append("</font>");
    mb.append("<br>");
    mb.append("<font face=arial size=-2>");
    mb.append("This is the password that you use to log in to your site.");
    mb.append("</font>");
    mb.append("</td>");
    mb.append("<td valign=top align=left>");
    mb.append("<input type=password name=password size=15 maxlength=50>");
    mb.append("</td>");
    mb.append("</tr>");


    mb.append("<tr>");
    mb.append("<td valign=top align=right>");
    mb.append("&nbsp;");
    mb.append("</td>");
    mb.append("<td valign=top align=left>");
    mb.append("<input type=submit value='Add Friend'>");
    mb.append("</form>");
    mb.append("</td>");
    mb.append("</tr>");

    mb.append("</table>");

    //End account details table

    mb.append("</td>");


    mb.append("</tr>");

    mb.append("</table>");
}


%>

<%
/*----------------------------------------------------*/
/*                  Side Column                       */
        StringBuffer sc = new StringBuffer();
/*----------------------------------------------------*/

//sc.append(reger.SideColumn.favorites(pageProps.logProps.logid, pageProps.logProps.megalogname));

%>

<%@ include file="globalfooter.jsp" %>

