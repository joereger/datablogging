
<%@ page import="java.util.*, reger.core.db.Db" %>

<%
/*----------------------------------------------------*/
/*                  Page Config                       */
reger.pageFramework.PageProps pageProps = new reger.pageFramework.PageProps();
pageProps.siteSection=pageProps.MASTERADMINSITE;
pageProps.title = "";
pageProps.isPasswordProtected = true;
pageProps.navButtonName = "loebugs";
pageProps.aclObjectName = "MASTERADMIN";
pageProps.pathToAppRoot="../";
/*----------------------------------------------------*/
%>

<%@ include file="../globalheader.jsp" %>

<%
/*----------------------------------------------------*/
/*                  Main Body                         */
    StringBuffer mb = new StringBuffer();
/*----------------------------------------------------*/



//Update
if (pageProps.action.equals("newbug")){

    if (request.getParameter("title")!=null && !request.getParameter("title").equals("")){

        int bugcategoryid=-1;
        if (request.getParameter("bugcategoryid")!=null && !reger.core.Util.isinteger(request.getParameter("bugcategoryid"))){
            bugcategoryid=Integer.parseInt(request.getParameter("bugcategoryid"));
        }
        if (request.getParameter("newbugcategory")!=null && !request.getParameter("newbugcategory").equals("")){
            //-----------------------------------
            //-----------------------------------
            bugcategoryid = Db.RunSQLInsert("INSERT INTO bugcategory(bugcategory) VALUES('"+reger.core.Util.cleanForSQL(request.getParameter("newbugcategory"))+"')");
            //-----------------------------------
            //-----------------------------------
        }

        //-----------------------------------
        //-----------------------------------
        int bugid = Db.RunSQLInsert("INSERT INTO bug(createdate, isopen, severity, bugcategoryid, title) VALUES('"+reger.core.TimeUtils.nowInGmtString()+"', '"+request.getParameter("isopen")+"', '"+request.getParameter("severity")+"', '"+bugcategoryid+"', '"+reger.core.Util.cleanForSQL(request.getParameter("title"))+"')");
        //-----------------------------------
        //-----------------------------------

        if (request.getParameter("comment")!=null && !request.getParameter("comment").equals("")){
            //-----------------------------------
            //-----------------------------------
            int identity = Db.RunSQLInsert("INSERT INTO bugcomment(bugid, date, comment) VALUES('"+bugid+"', '"+reger.core.TimeUtils.nowInGmtString()+"', '"+reger.core.Util.cleanForSQL(request.getParameter("comment"))+"')");
            //-----------------------------------
            //-----------------------------------
        }

        response.sendRedirect("bugs.log");
        return;
    } else {
        mb.append("<font face=arial size=+1>Title is required. Comments have been retained but status, severity and category have not.</font>");
    }

}





//Start the page display

mb.append("<style type=text/css>");
mb.append("<--");
mb.append(".bug:link {color:#0000ff; text-decoration:none; font-size: 9px;}");
mb.append(".bug:active {color:#0000ff; text-decoration:underline; font-size: 9px;}");
mb.append(".bug:visited {color:#0000ff; text-decoration:none; font-size: 9px;}");
mb.append(".bug:hover {color: #ff0000; text-decoration:underline; background-color: #cccccc; font-size: 9px;}");
mb.append(".bug {color:#000000; text-decoration:none; font-size: 9px;}");
mb.append(".bugbig:link {color:#0000ff; text-decoration:none; font-size: 12px;}");
mb.append(".bugbig:active {color:#0000ff; text-decoration:underline; font-size: 12px;}");
mb.append(".bugbig:visited {color:#0000ff; text-decoration:none; font-size: 12px;}");
mb.append(".bugbig:hover {color: #ff0000; text-decoration:underline; background-color: #cccccc; font-size: 12px;}");
mb.append(".bugbig {color:#000000; text-decoration:none; font-size: 12px;}");
mb.append(".bugsmall:link {color:#0000ff; text-decoration:none; font-size: 6px;}");
mb.append(".bugsmall:active {color:#0000ff; text-decoration:underline; font-size: 6px;}");
mb.append(".bugsmall:visited {color:#0000ff; text-decoration:none; font-size: 6px;}");
mb.append(".bugsmall:hover {color: #000000; text-decoration:underline; background-color: #e6e6e6; font-size: 6px;}");
mb.append(".bugsmall {color:#000000; text-decoration:none; font-size: 6px;}");
mb.append("-->");
mb.append("<style></style>");

mb.append("<a href='bugs.log'><img src=images/bugs.jpg border=0></a><br>");

mb.append("<form action=bugnew.log method=post>");
mb.append("<input type=hidden name=action value=newbug>");
mb.append("<table cellpadding=5 cellspacing=0 width=100% border=1>");


mb.append("<tr>");

//Date
mb.append("<td valign=top align=left nowrap bgcolor=#e6e6e6>");
mb.append("<font face=arial size=-2 class=bug>");
mb.append("&nbsp;");
mb.append("</font>");
mb.append("</td>");


//Bug title
String title="";
if (request.getParameter("title")!=null && !request.getParameter("title").equals("")){
    title=request.getParameter("title");
}
mb.append("<td valign=top align=left>");
mb.append("<input type=text name=title size=35 maxlength=255 value='"+title+"' style='font: 14pt Arial'>");
mb.append("</td>");




//Status
mb.append("<td valign=top bgcolor=#ffffff align=left>");
mb.append("<font face=arial size=-1 class=bug>");
mb.append("<select name=isopen style=\"font-size: 10px;\">");
mb.append("<option value='1'>Open</option>");
mb.append("<option value='0'>Closed</option>");
mb.append("</select>");



mb.append("</td>");


//Status
mb.append("<td valign=top bgcolor=#ffffff align=left>");
mb.append("<font face=arial size=-1 class=bug>");
mb.append("<select name=severity style=\"font-size: 10px;\">");
for(int j=1; j<=3; j++){
    String sevText="";
    if (j==1){
        sevText="High";
    } else if (j==2){
        sevText="Med";
    } else if (j==3){
        sevText="Low";
    }
    mb.append("<option value='"+j+"'>"+j+ " - " +sevText+"</option>");
}
mb.append("</select>");
mb.append("</font>");
mb.append("</td>");




//Bug category
mb.append("<td valign=top align=left nowrap>");
mb.append("<select name=bugcategoryid style=\"font-size: 10px;\">");
//-----------------------------------
//-----------------------------------
String[][] rsCat= Db.RunSQL("SELECT bugcategory.bugcategoryid, bugcategory.bugcategory FROM bugcategory");
//-----------------------------------
//-----------------------------------
if (rsCat!=null && rsCat.length>0){
    for(int j=0; j<rsCat.length; j++){
        mb.append("<option value='"+rsCat[j][0]+"'>"+rsCat[j][1]+ "</option>");
    }
}
mb.append("</select>");
mb.append("<br>");
mb.append("<font face=arial size=-2 class=bugsmall>");
mb.append("Or add new:");
mb.append("</font>");
mb.append("<br>");
mb.append("<input type=text name=newbugcategory size=10 maxlength=50 style=\"font-size: 10px;\">");
mb.append("</td>");


mb.append("</tr>");


//Comment
String comment="";
if (request.getParameter("comment")!=null && !request.getParameter("comment").equals("")){
    comment=request.getParameter("comment");
}
mb.append("<tr>");
mb.append("<td valign=top align=center bgcolor=#e6e6e6>");
mb.append("<input type=submit value=Save>");
mb.append("</tr>");
mb.append("<td valign=top align=left colspan=4>");
mb.append("<textarea cols='45' rows='10' name='comment' wrap='hard' style='width: 80%;font: 10pt Arial'>");
mb.append(comment.replaceAll("<", "&lt"));
mb.append("</textarea>");
mb.append("</tr>");
mb.append("</tr>");


mb.append("</form>");
mb.append("</table>");



%>


<%
/*----------------------------------------------------*/
/*                  Side Column                       */
    StringBuffer sc = new StringBuffer();
/*----------------------------------------------------*/

    //sc.append("This is a ");
    //sc.append("side column section.");
%>


<%@ include file="../globalfooter.jsp" %>







