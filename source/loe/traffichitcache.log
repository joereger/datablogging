
<%@ page import="java.util.*,
                 reger.core.db.Db,
                 reger.cache.TrafficHitCache,
                 reger.TrafficHit" %>

<%
/*----------------------------------------------------*/
/*                  Page Config                       */
reger.pageFramework.PageProps pageProps = new reger.pageFramework.PageProps();
pageProps.siteSection=pageProps.MASTERADMINSITE;
pageProps.title = "Traffic Hit Cache";
pageProps.isPasswordProtected = true;
pageProps.navButtonName = "loetraffichitcache";
pageProps.aclObjectName = "MASTERADMIN";
pageProps.pathToAppRoot="../";
/*----------------------------------------------------*/
%>

<%@ include file="../globalheader.jsp" %>

<%
/*----------------------------------------------------*/
/*                  Main Body                         */
    StringBuffer mb = new StringBuffer();
/*----------------------------------------------------*/

if (request.getParameter("action")!=null && request.getParameter("action").equals("reset")){

    reger.cache.TrafficHitCache.saveAndPurge();

    mb.append(reger.InfoBox.get(reger.InfoBox.BOXTYPECOMPLETE, pageProps.pathToAppRoot, "Traffic cache has been saved and purged."));
}


mb.append("<br><br>");
mb.append("<font face=arial size=+2>");
mb.append("It's important to write traffic data to the database, but not at the expense of performance.  Instead of writing to the database on each page call it is stored in a memory cache.  Every five minutes it is written to the database.  This page shows you how big the cache is.");
mb.append("</font>");
mb.append("<br>");

mb.append("<font face=arial size=-1>");
mb.append("<a href='traffichitcache.log?action=reset'>");
mb.append("Save and Purge Now");
mb.append("</a>");
mb.append("</font>");
mb.append("<br><br>");

mb.append("<font face=arial size=+1>");
mb.append("The Traffic Hit Cache is holding " + reger.cache.TrafficHitCache.getNumberOfCachedTrafficHits() + " hits.");
mb.append("</font>");
mb.append("<br><br>");


mb.append("<font face=arial size=+1>");
mb.append("The Traffic Hit Cache is using an estimated " + reger.cache.TrafficHitCache.getEstimatedMemoryUsage() + " bytes of memory.");
mb.append("</font>");
mb.append("<br><br>");

mb.append("<pre>");
mb.append(reger.cache.TrafficHitCache.getHitsAsBigLongUglyString());
mb.append("</pre>");


%>

<%
/*----------------------------------------------------*/
/*                  Side Column                       */
    StringBuffer sc = new StringBuffer();
/*----------------------------------------------------*/

    //sc.append("This is a ");
    //sc.append("side column section.");
%>


<%@ include file="../globalfooter.jsp" %>







