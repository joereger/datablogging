<%@ page import="reger.core.db.Db"%>
<%
/*----------------------------------------------------*/
/*                  Page Config                       */
reger.pageFramework.PageProps pageProps = new reger.pageFramework.PageProps();
pageProps.siteSection=pageProps.PUBLICSITE;
pageProps.isPasswordProtected = false;
pageProps.isLogidRequired=false;
pageProps.isEventidRequired=false;
pageProps.trafficType=reger.Vars.TRAFFICTYPEPUBLICMISC;
pageProps.pathToAppRoot="";
/*----------------------------------------------------*/
%>

<%@ include file="globalheader.jsp" %>

<%
/*----------------------------------------------------*/
/*                  Main Body                         */
        StringBuffer mb = new StringBuffer();
/*----------------------------------------------------*/


//Get the accountuseridtarget
int accountuseridtarget = -1;
if (request.getParameter("accountuseridtarget")!=null && reger.core.Util.isinteger(request.getParameter("accountuseridtarget"))){
    accountuseridtarget = Integer.parseInt(request.getParameter("accountuseridtarget"));

    //Set the session var
    session.setAttribute( "accountuseridtarget", String.valueOf(accountuseridtarget));
}

//Create an accountuser object for the target
reger.Accountuser autarget = new reger.Accountuser(accountuseridtarget, true);


if (pageProps.action.equals("redirect")){
    boolean success = false;
    if (request.getParameter("siteurl")!=null && !request.getParameter("siteurl").equals("")){
        String siteUrl = reger.core.Util.stripHttpHttpsAndTrailingSlashFromUrl(request.getParameter("siteurl"));

        //Set the success var
        success=true;
        //Do the redirect
        try {
            response.sendRedirect(reger.Vars.getHttpUrlPrefix() + siteUrl + "/friendassociateend.log?accountuseridtarget=" + accountuseridtarget);
            return;
        } catch (Exception e){
            reger.core.Util.errorsave(e);
        }
        out.println("<br>Error redirecting to your site.  Please use your browser's back button and try again.");
        return;
    }
}



//Start page
mb.append("<br><br>");




//Display the default form
mb.append("<img src='"+autarget.primaryImage(pageProps.pathToAppRoot, true)+"' border=0 align=left width=100>");
mb.append("<font face=arial size=+2>");
mb.append("Make "+autarget.getFriendlyname()+" Your Friend");
mb.append("</font>");
mb.append("<br>");
mb.append("<font face=arial size=-2>");
mb.append("This page creates a friend association between "+autarget.getFriendlyname()+" and you.  To do this we need to know who you are.  If you don't have an account you can create one and your friend will automatically be associated with you.");
mb.append("</font>");

mb.append("<br clear=all>");

mb.append("<form action=friendassociatestart.log method=post>");
mb.append("<input type=hidden name=action value=redirect>");
mb.append("<input type=hidden name=accountuseridtarget value="+accountuseridtarget+">");
mb.append("<table cellpadding=5 cellspacing=8 border=0 width=80% align=center bgcolor=#e6e6e6>");

mb.append("<tr>");
mb.append("<td valign=top bgcolor=#ffffff>");

//Account details table

mb.append("<table cellpadding=3 cellspacing=2 border=0 width=100% align=center bgcolor=#ffffff>");


mb.append("<tr>");
mb.append("<td valign=top align=left colspan=2 bgcolor=#e6e6e6>");
mb.append("<font face=arial size=+1>");
mb.append("<strong>");
mb.append("Your Site");
mb.append("</strong>");
mb.append("</font>");
mb.append("</td>");
mb.append("</tr>");


mb.append("<tr>");
mb.append("<td valign=top align=left colspan=2>");
mb.append("<font face=arial size=-2>");
mb.append("<strong>");
mb.append("To be friends with "+autarget.getFriendlyname()+" you must have a site enabled on the same technology platform.  If you do, enter your url below.  We'll redirect you back to your site where you can complete the friendship.  Your information is not shared with "+autarget.getFriendlyname()+". ");
mb.append("</strong>");
mb.append("</font>");
mb.append("</td>");
mb.append("</tr>");


mb.append("<tr>");
mb.append("<td valign=top align=right>");
mb.append("<font face=arial size=-1>");
mb.append("<strong>");
mb.append("Your Site Url:");
mb.append("</strong>");
mb.append("</font>");
mb.append("<br>");
mb.append("<font face=arial size=-2>");
mb.append("Example: \"myweblog."+userSession.getPl().getPlbasedomain()+"\" or \""+userSession.getPl().getPlbasedomain()+"/~myweblog\"");
mb.append("</font>");
mb.append("</td>");
mb.append("<td valign=top align=left>");
mb.append("<input type=text name=siteurl size=15 maxlength=255>");
mb.append("</td>");
mb.append("</tr>");





mb.append("<tr>");
mb.append("<td valign=top align=right>");
mb.append("&nbsp;");
mb.append("</td>");
mb.append("<td valign=top align=left>");
mb.append("<input type=submit value='Go To Step 2'>");
mb.append("</form>");

mb.append("<a href='"+pageProps.pathToAppRoot+"about/signup.log'>");
mb.append("<font face=arial size=-2>");
mb.append("<strong>");
mb.append("Don't Have an Account?  Sign Up For Free.");
mb.append("</strong>");
mb.append("</font>");
mb.append("</a>");

mb.append("</td>");
mb.append("</tr>");

mb.append("</table>");

//End account details table

mb.append("</td>");

mb.append("<td valign=top bgcolor=#ffffff>");

//Begin signup table

mb.append("<table cellpadding=3 cellspacing=2 border=0 width=100% align=center bgcolor=#ffffff>");


mb.append("<tr>");
mb.append("<td valign=top align=left bgcolor=#e6e6e6>");
mb.append("<font face=arial size=+1>");
mb.append("<strong>");
mb.append("Or Sign Up:");
mb.append("</strong>");
mb.append("</font>");
mb.append("</td>");
mb.append("</tr>");


mb.append("<tr>");
mb.append("<td valign=top align=left>");

mb.append("<form action="+pageProps.pathToAppRoot+"about/signup.log method=get>");
mb.append("<input type=submit value='Signup For Free'>");
mb.append("</form>");

mb.append("<font face=arial size=-2>");
mb.append("Creating an account is quick, easy, free and fun.  You'll get your own url, your own profile and your own web log.  You'll also be able to start building your personal network of friends, family and associates.");
mb.append("</font>");

mb.append("</td>");
mb.append("</tr>");

mb.append("</table>");


//End signup table

mb.append("</td>");
mb.append("</tr>");

mb.append("</table>");



%>

<%
/*----------------------------------------------------*/
/*                  Side Column                       */
        StringBuffer sc = new StringBuffer();
/*----------------------------------------------------*/

//sc.append(reger.SideColumn.favorites(pageProps.logProps.logid, pageProps.logProps.megalogname));

%>

<%@ include file="globalfooter.jsp" %>

