<%@ page import="reger.SideColumn,
                 reger.template.Template,
                 reger.template.AllTemplatesInSystem,
                 reger.template.HpTemplateProcessor,
                 reger.Log"%>
<%@ page import="reger.cache.LogCache"%>
<%
/*----------------------------------------------------*/
/*                  Page Config                       */
reger.pageFramework.PageProps pageProps = new reger.pageFramework.PageProps();
pageProps.siteSection=pageProps.PUBLICSITE;
pageProps.isPasswordProtected = false;
pageProps.isLogidRequired=true;
pageProps.trafficType=reger.Vars.TRAFFICTYPEPUBLICLOGSECTION;
pageProps.pathToAppRoot="";
/*----------------------------------------------------*/
%>

<%@ include file="globalheader.jsp" %>

<%


/*----------------------------------------------------*/
/*                  Main Body                         */
        StringBuffer mb = new StringBuffer();
/*----------------------------------------------------*/

//Get a list of entries
//mb.append(reger.htmlListEvents.getList(userSession, pageProps.logProps.logid, reger.core.Util.getCurrentPage(request.getParameter("currentpage")), request.getParameter("viewdate"), request.getParameter("viewmonth"), "logmain.log", -1, true, request));

Log log = LogCache.get(pageProps.logProps.logid);
if(log!=null){
    Template template = AllTemplatesInSystem.getTemplateByTemplateid(log.getMaintemplateid(), Template.TEMPLATETYPEHOMEPAGE);
    String tmp = "";
    if (template!=null){
        tmp = template.getTemplate();
        reger.core.Util.debug(5, "logmain.log - found valid template:<br>" + tmp);
    }  else {
        Template tmpTemplate = AllTemplatesInSystem.getTemplateByTemplateid(userSession.getPl().getHptemplateid(), Template.TEMPLATETYPEHOMEPAGE);
        tmp = tmpTemplate.getTemplate();
        reger.core.Util.debug(5, "logmain.log - using pl default template:<br>" + tmp);
    }
    //Output the page layout
    mb.append(HpTemplateProcessor.getHtml(tmp, userSession, request, pageProps));
} else {
    response.sendRedirect("index.log");
    return;
}

%>

<%
/*----------------------------------------------------*/
/*                  Side Column                       */
        StringBuffer sc = new StringBuffer();
/*----------------------------------------------------*/


//Charts and Graphs
sc.append(reger.SideColumn.chartsngraphs(pageProps.logProps.logid, userSession));

//Favorite entries
sc.append(reger.SideColumn.favorites(pageProps.logProps.logid, pageProps.logProps.megalogname));

//Messages for this log
sc.append(reger.SideColumn.messages(pageProps.logProps.logid, pageProps.logProps.megalogname));

//Calendar
sc.append(reger.CalendarHtml.smallcalendar(reger.Vars.CALENDARTYPEEMPTYEVENTFINDER, request.getParameter("viewmonth"), pageProps.logProps.logid, "logmain.log", userSession));

//Xml link
sc.append("<br><!-- XML Start --><a href='rssfeeds.log'><img src='images/xml-newsfeed.png' alt='View this site in XML RSS 2.0' border=0></a><!-- XML End -->");



%>

<%@ include file="globalfooter.jsp" %>

