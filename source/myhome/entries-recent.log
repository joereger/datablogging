<%@ page import="reger.core.Util,
                 reger.core.db.Db"%>
<%
/*----------------------------------------------------*/
/*                  Page Config                       */
reger.pageFramework.PageProps pageProps = new reger.pageFramework.PageProps();
pageProps.siteSection=pageProps.ADMINSITE;
pageProps.title = "Recent Posts";
pageProps.isPasswordProtected = true;
pageProps.navButtonName = "entriesrecent";
pageProps.aclObjectName = "ADDEDITENTRIES";
pageProps.trafficType=reger.Vars.TRAFFICTYPEADMINMISC;
pageProps.pathToAppRoot="../";
pageProps.helpText="This page helps you find old entries so that you can edit, delete or move them.<br><br>Enter a search term and click Search or browse your most recent entries.";
/*----------------------------------------------------*/
%>

<%@ include file="../globalheader.jsp" %>

<%
/*----------------------------------------------------*/
/*                  Main Body                         */
        StringBuffer mb = new StringBuffer();
/*----------------------------------------------------*/





    mb.append("<div class=\"row\">");
    mb.append("<div class=\"span6\">");

    mb.append("<table class=\"table table-striped\">");
    //@todo Add paging to /myhome/entries.log list
    //-----------------------------------
    //-----------------------------------
    String[][] rstLastentries= Db.RunSQL("SELECT event.eventid, event.title, event.date FROM event, megalog WHERE event.logid=megalog.logid AND event.accountid='"+ userSession.getAccount().getAccountid() +"' AND "+userSession.getAccountuser().LogsUserCanAdministerQueryend(userSession.getAccount().getAccountid())+" AND event.istemporary='0' ORDER BY event.date DESC LIMIT 0,100");
    //-----------------------------------
    //-----------------------------------
    if (rstLastentries!=null && rstLastentries.length>0){
        for(int i=0; i<rstLastentries.length; i++){
            mb.append("<tr>");
            //@todo Check /myhome/entries.log for timezone
            //@todo Add /myhome/entries.log Agotext


            mb.append("<td><strong>"+reger.core.Util.truncateString(reger.core.Util.cleanForHtml(rstLastentries[i][1]), 100)+"</strong><br/><h6>"+reger.core.TimeUtils.agoText(reger.core.TimeUtils.dbstringtocalendar(rstLastentries[i][2]))+"</h6></td>");
            mb.append("<td style=\"width:100px;\" nowrap>");

            mb.append("<div class=\"btn-group\">" + "\n");
            mb.append("<a class=\"btn btn-success\" href=\"entry.log?eventid="+rstLastentries[i][0]+"&action=edit\"><i class=\"icon-edit icon-white\"></i> Edit</a>" + "\n");
            mb.append("<a class=\"btn dropdown-toggle\" data-toggle=\"dropdown\" href=\"#\">" + "\n");
            mb.append("<span class=\"caret\"></span>" + "\n");
            mb.append("</a>" + "\n");
            mb.append("<ul class=\"dropdown-menu\">" + "\n");
            mb.append("<li><a href=\"../entry.log?eventid="+rstLastentries[i][0]+"\">View</a></li>" + "\n");
            mb.append("<li><a href=\"entry-move.log?eventid="+rstLastentries[i][0]+"\">Move</a></li>" + "\n");
            mb.append("<li><a href=\"entry-delete.log?eventid="+rstLastentries[i][0]+"\">Delete</a></li>" + "\n");
            mb.append("</ul>" + "\n");
            mb.append("</div>" + "\n");

            mb.append("</td>");

            mb.append("</tr>");
        }
    }


    mb.append("</table>");
    mb.append("<!-- End last edited -->");


    mb.append("</div>");
    mb.append("</div>");



%>

<%
/*----------------------------------------------------*/
/*                  Side Column                       */
    StringBuffer sc = new StringBuffer();
/*----------------------------------------------------*/

//sc.append("This is a ");
//sc.append("side column section.");
%>


<%@ include file="../globalfooter.jsp" %>
