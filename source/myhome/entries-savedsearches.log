<%@ page import="reger.core.Util,
                 reger.core.db.Db,
                 reger.Help"%>
<%
/*----------------------------------------------------*/
/*                  Page Config                       */
reger.pageFramework.PageProps pageProps = new reger.pageFramework.PageProps();
pageProps.siteSection=pageProps.ADMINSITE;
pageProps.title = "Saved Searches";
pageProps.isPasswordProtected = true;
pageProps.navButtonName = "entriessaved";
pageProps.aclObjectName = "SAVESEARCHES";
pageProps.trafficType=reger.Vars.TRAFFICTYPEADMINMISC;
pageProps.pathToAppRoot="../";
/*----------------------------------------------------*/
%>

<%@ include file="../globalheader.jsp" %>

<%
/*----------------------------------------------------*/
/*                  Main Body                         */
        StringBuffer mb = new StringBuffer();
/*----------------------------------------------------*/




if (userSession.getAccount().isPro() && userSession.getAccount().getIssearchmysiteon()==1) {

    if (pageProps.action.equals("delete")){
        if (request.getParameter("savedsearchid")!=null && reger.core.Util.isinteger(request.getParameter("savedsearchid"))){
            reger.search.SearchParameters sparams = new reger.search.SearchParameters(Integer.parseInt(request.getParameter("savedsearchid")));
            //Make sure the user can deal with searches for the actual account of the search
            if (userSession.getAccountuser().userCanDoAcl("SAVESEARCHES", sparams.accountid)){
                sparams.delete();
            }
        }
    }

    mb.append("<font face=arial size=-1 class=mediumfont>");
    //-----------------------------------
    //-----------------------------------
    String[][] rstSavedSearch= Db.RunSQL("SELECT savedsearch.savedsearchid, savedsearch.name FROM savedsearch, megalog, savedsearchlog WHERE savedsearch.savedsearchid=savedsearchlog.savedsearchid AND savedsearchlog.logid=megalog.logid AND "+userSession.getAccountuser().LogsUserCanViewQueryend(userSession.getAccount().getAccountid())+" GROUP BY savedsearchid ORDER BY savedsearch.name ASC");
    //-----------------------------------
    //-----------------------------------
    if (rstSavedSearch!=null && rstSavedSearch.length>0){
        for(int i=0; i<rstSavedSearch.length; i++){
            mb.append("(");
            mb.append("<a href='entries-savedsearches.log?action=delete&savedsearchid="+rstSavedSearch[i][0]+"'>");
            mb.append("Delete");
            mb.append("</a>");
            mb.append(") ");

            mb.append("<a href='entries.log?savedsearchid="+rstSavedSearch[i][0]+"'>");
            mb.append(rstSavedSearch[i][1]);
            mb.append("</a>");
            mb.append("<br>");
        }
    } else {
        mb.append("No saved searches are available.");
    }
    mb.append("</font>");

}




mb.append("<br><br>");


%>

<%
/*----------------------------------------------------*/
/*                  Side Column                       */
    StringBuffer sc = new StringBuffer();
/*----------------------------------------------------*/

//sc.append("This is a ");
//sc.append("side column section.");
%>


<%@ include file="../globalfooter.jsp" %>
