<%@ page import="reger.core.Util,
                 reger.core.db.Db,
                 reger.search.SearchUIFlowAdvSearch,
                 reger.Location,
                 reger.LocationRenderHtml"%>
<%
/*----------------------------------------------------*/
/*                  Page Config                       */
reger.pageFramework.PageProps pageProps = new reger.pageFramework.PageProps();
pageProps.siteSection=pageProps.ADMINSITE;
pageProps.title = "Edit Location";
pageProps.isPasswordProtected = true;
pageProps.navButtonName = "entrieslocations";
pageProps.aclObjectName = "ADDEDITENTRIES";
pageProps.trafficType=reger.Vars.TRAFFICTYPEADMINMISC;
pageProps.pathToAppRoot="../";
pageProps.helpText="This page helps you maintain locations that you can use on your entries.";
/*----------------------------------------------------*/
%>

<%@ include file="../globalheader.jsp" %>

<%
/*----------------------------------------------------*/
/*                  Main Body                         */
        StringBuffer mb = new StringBuffer();
/*----------------------------------------------------*/

//Parse the incoming locationid
int locationid=0;
Location loc = null;
if (request.getParameter("locationid")!=null && !request.getParameter("locationid").equals("") && reger.core.Util.isinteger(request.getParameter("locationid"))){
    locationid=Integer.parseInt(request.getParameter("locationid"));
    //@todo Make sure user can view this location
    loc = new Location(locationid);
}

//If we don't have a location, redirect
if (loc==null || loc.getLocationid()==0){
    response.sendRedirect("entries-locations.log");
    return;
}

//Make sure this user can edit this location
if (loc.getAccountid()!=userSession.getAccount().getAccountid()){
    response.sendRedirect("entries-locations.log");
    return;
}

//Edit
if (pageProps.action.equals("edit")){
    loc.populateFromRequest(request);
    loc.save();
    response.sendRedirect("entries-locations.log");
    return;
}

//Delete
if (pageProps.action.equals("delete")){
    loc.delete();
    response.sendRedirect("entries-locations.log");
    return;
}

//Start edit
if (pageProps.action.equals("editstart")){
    mb.append("<form action=entries-locations-edit.log method=post>");
    mb.append("<input type=hidden name=action value=edit>");
    mb.append("<input type=hidden name=locationid value="+loc.getLocationid()+">");
    mb.append(LocationRenderHtml.getSingleLocationAsHtml(loc, true, ""));
    mb.append("<br>");
    mb.append("<input type=submit value='Edit Location'>");
    mb.append("</form>");
}

//Start delete
if (pageProps.action.equals("deletestart")){
    mb.append("<form action=entries-locations-edit.log method=post>");
    mb.append(reger.InfoBox.get(reger.InfoBox.BOXTYPEINFO, pageProps.pathToAppRoot, "Are you sure you want to delete the location \""+loc.getLocationname()+"\"?"));
    mb.append("<input type=hidden name=action value=delete>");
    mb.append("<input type=hidden name=locationid value="+loc.getLocationid()+">");
    mb.append("<input type=submit value='Yes, Delete this Location'>");
    mb.append("</form>");
    mb.append("<font face=arial size=-2>");
    mb.append("<a href='entries-locations.log'>");
    mb.append("Sorry, Just Kidding, Don't Delete.");
    mb.append("</a>");
    mb.append("</font>");
}




mb.append("<br><br>");







%>

<%
/*----------------------------------------------------*/
/*                  Side Column                       */
    StringBuffer sc = new StringBuffer();
/*----------------------------------------------------*/

//sc.append("This is a ");
//sc.append("side column section.");
%>


<%@ include file="../globalfooter.jsp" %>
