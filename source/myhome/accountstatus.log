<%@ page import="reger.core.db.Db,
                 java.util.Hashtable,
                 java.text.NumberFormat,
                 java.util.Locale,
                 reger.PrivateLabel,
                 reger.core.licensing.License,
                 reger.UserSession"%>
<%@ page import="reger.core.TimeUtils"%>
<%
/*----------------------------------------------------*/
/*                  Page Config                       */
reger.pageFramework.PageProps pageProps = new reger.pageFramework.PageProps();
pageProps.siteSection=pageProps.ADMINSITE;
pageProps.title = "Account License Status";
pageProps.isPasswordProtected = true;
pageProps.navButtonName = "settingsacctstatus";
pageProps.aclObjectName = "ADMINHOME";
pageProps.trafficType=reger.Vars.TRAFFICTYPEADMINMISC;
pageProps.pathToAppRoot="../";
/*----------------------------------------------------*/
%>

<%@ include file="../globalheader.jsp" %>

<%
/*----------------------------------------------------*/
/*                  Main Body                         */
            StringBuffer mb = new StringBuffer();
/*----------------------------------------------------*/






    mb.append("<!-- Body Table Start -->");

    mb.append("<table cellpadding=3 cellspacing=1 width=100% border=0>");





    //Start User Account
    mb.append("<tr>");
    mb.append("<td valign=top align=left colspan=2 bgcolor=#999999><font face=arial size=-1>");
    mb.append("<strong>User License</strong>");
    mb.append("</font></td>");
    mb.append("</tr>");

    mb.append("<tr>");
    mb.append("<td bgcolor=#cccccc><font face=arial size=-1><strong>Account type</strong></font></td>");
    if (userSession.getAccount().isPro()) {
        mb.append("<td bgcolor=#e6e6e6><font face=arial size=-1>Pro</font>");
    } else {
        mb.append("<td bgcolor=#e6e6e6><font face=arial size=-1>Standard</font>");
    }
    mb.append("</td>");
    mb.append("</tr>");

    mb.append("<tr>");
    mb.append("<td width=25% bgcolor=#cccccc><font face=arial size=-1><strong>Max Storage Space</strong></font></td>");
    if (userSession.getAccount().getMaxspaceinbytes()>0){
        mb.append("<td bgcolor=#e6e6e6><font face=arial size=-1>"+userSession.getAccount().getMaxspaceinbytes()/(long)1000000+" Mb</font></td>");
    } else {
        mb.append("<td bgcolor=#e6e6e6><font face=arial size=-1>Unlimited</font></td>");
    }
    mb.append("</tr>");

    mb.append("<tr>");
    mb.append("<td bgcolor=#cccccc><font face=arial size=-1><strong>Max Monthly Bandwidth</strong></font></td>");
    if (userSession.getAccount().getMaxbandwidth()>0){
        mb.append("<td bgcolor=#e6e6e6><font face=arial size=-1>"+(double)userSession.getAccount().getMaxbandwidth()/(double)1000000+" Mb</font></td>");
    } else {
        mb.append("<td bgcolor=#e6e6e6><font face=arial size=-1>Unlimited</font></td>");
    }
    mb.append("</tr>");



    if (!userSession.getAccount().getLicense().getProperty(License.PROPSTRINGINDIVIDUALUSERSPAYTOUPGRADEACCOUNTS).equals("0")){

       if (!userSession.getAccount().getLicense().getProperty(License.PROPSTRINGISRECURRINGBILLING).equals("1")){
            mb.append("<tr>");
            mb.append("<td bgcolor=#cccccc><font face=arial size=-1><strong>License Expiration Date (GMT)</strong></font></td>");
            mb.append("<td bgcolor=#e6e6e6><font face=arial size=-1>"+userSession.getAccount().getLicense().getProperty(License.PROPSTRINGEXPDATEGMT)+"</font></td>");
            mb.append("</tr>");
       }

        mb.append("<tr>");
        mb.append("<td bgcolor=#cccccc><font face=arial size=-1><strong>License Key</strong></font></td>");
        mb.append("<td bgcolor=#e6e6e6><font face=arial size=-2><!--<textarea rows=5 cols=35>-->"+userSession.getAccount().getLicense().getEncryptedLicense()+"<!--</textarea>--></font></td>");
        mb.append("</tr>");

        mb.append("<tr>");
        mb.append("<td bgcolor=#cccccc><font face=arial size=-1><strong>Account License Integrity Last Checked</strong></font></td>");
        mb.append("<td bgcolor=#e6e6e6><font face=arial size=-1>");
        mb.append(TimeUtils.dateformatfordb(userSession.getAccount().getLastbillingcheck()));
        mb.append("</font></td>");
        mb.append("</tr>");

        mb.append("<tr>");
        mb.append("<td bgcolor=#cccccc><font face=arial size=-1><strong>Account License Status</strong></font></td>");
        mb.append("<td bgcolor=#e6e6e6><font face=arial size=-1>");
        if (userSession.getAccount().getBillingerror().equals("")){
            mb.append("Ok");
        } else {
            mb.append("Billing Error: ");
            mb.append(userSession.getAccount().getLastbillingcheck());
        }
        mb.append("</font></td>");
        mb.append("</tr>");



        mb.append("<tr>");
        mb.append("<td bgcolor=#cccccc><font face=arial size=-1></font></td>");
        mb.append("<td bgcolor=#e6e6e6>");
        if (!userSession.getAccount().isPro()) {
            mb.append("<a href='"+userSession.getPl().getPlBaseUrl(userSession)+"/about/accountupgrade1.log?accountid="+userSession.getAccount().getAccountid()+"&plid="+userSession.getPl().getPlid()+"'><font face=arial size=-1>Upgrade Account to Pro</font></a>");
            mb.append("<br><font face=arial size=-1><a href='accountprofeatures.log'>View Pro Upgrade Features.</a></font>");
        } else {
            mb.append("<a href='accountcancel.log'><font face=arial size=-1>Cancel Account License</font></a>");
            mb.append("<br><a href='"+userSession.getPl().getPlBaseUrl(userSession)+"/about/accountupgrade1.log?accountid="+userSession.getAccount().getAccountid()+"&plid="+userSession.getPl().getPlid()+"'><font face=arial size=-1>Upgrade/Edit/Change Account License</font></a>");
        }
        mb.append("<br><a href='accountlicensemanualentry.log'><font face=arial size=-1>Click Here to Manually Add/Edit License Key (Not Recommended)</font></a>");
        mb.append("</td>");

        mb.append("</tr>");

    } else {

        mb.append("<tr>");
        mb.append("<td bgcolor=#cccccc>");
        mb.append("</td>");
        mb.append("<td bgcolor=#e6e6e6><font face=arial size=-1>");
        mb.append("Accounts on this installation are governed by a Server License.  Contact your system admin if you have questions or visit the <a href='http://www.reger.com/jforum/'>support forum</a>.");
        mb.append("</font></td>");
        mb.append("</tr>");

    }
    //End User Account

    if (userSession.getAccountuser().userCanDoAcl("MASTERADMIN", userSession.getAccount().getAccountid())){
        mb.append("<tr>");
        mb.append("<td bgcolor=#cccccc>");
        mb.append("</td>");
        mb.append("<td bgcolor=#e6e6e6><font face=arial size=-1>");
        //mb.append("<a href='../loe/plmanage.log?action=editstart&plid="+userSession.getPl().getPlid()+"'>Click here to view the Private Label License</a>");
        //mb.append("<br>");
        mb.append("<a href='../loe/systemlicense.log'>Click here to view the Server License</a>");
        mb.append("</font></td>");
        mb.append("</tr>");
    }










    mb.append("</table>");










%>

<%
/*----------------------------------------------------*/
/*                  Side Column                       */
            StringBuffer sc = new StringBuffer();
/*----------------------------------------------------*/

//sc.append("This is a ");
//sc.append("side column section.");
%>


<%@ include file="../globalfooter.jsp" %>
