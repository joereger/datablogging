<%@ page import="reger.core.db.Db,
                 reger.core.Util,
                 java.util.TreeMap,
                 reger.mega.FieldType,
                 reger.mega.FieldLayout,
                 reger.mega.Field"%>
<%
/*----------------------------------------------------*/
/*                  Page Config                       */
reger.pageFramework.PageProps pageProps = new reger.pageFramework.PageProps();
pageProps.siteSection=pageProps.ADMINSITE;
pageProps.title = "<img src='../images/icon-log-type-med-notext.gif' align=top> Customize Log Properties";
pageProps.isPasswordProtected = true;
pageProps.navButtonName = "logsyourlogs";
pageProps.aclObjectName = "CUSTOMIZELOG";
pageProps.trafficType=reger.Vars.TRAFFICTYPEADMINMISC;
pageProps.pathToAppRoot="../";
//pageProps.isLogidRequired=true;
/*----------------------------------------------------*/
%>

<%@ include file="../globalheader.jsp" %>

<%
/*----------------------------------------------------*/
/*                  Main Body                         */
        StringBuffer mb = new StringBuffer();
/*----------------------------------------------------*/


//Make sure we have an eventtypeid
int eventtypeid=-1;
if (request.getParameter("eventtypeid")!=null && !request.getParameter("eventtypeid").equals("") && reger.core.Util.isinteger(request.getParameter("eventtypeid"))){
    eventtypeid=Integer.parseInt(request.getParameter("eventtypeid"));
}

//Make sure this is a valid logtype for the user to be editing, and if this is valid
//-----------------------------------
//-----------------------------------
    String[][] rstCheckLog= Db.RunSQL("SELECT accountuserid FROM megalogtype WHERE eventtypeid='"+ eventtypeid +"'");
//-----------------------------------
//-----------------------------------
if (rstCheckLog!=null && rstCheckLog.length>0){
    if (!rstCheckLog[0][0].equals(String.valueOf(userSession.getAccountuser().getAccountuserid()))) {
        out.println("<font face=arial size=+3 color=red>Sorry. That log type can't be edited.</font>");
        return;
    }
} else {
    out.println("<font face=arial size=+3 color=red>Sorry. That log type can't be edited.</font>");
    return;
}

//Process any layout changes
FieldLayout.processLayoutChange(request);



//Log Header start
String currentNavButtonName = "logs-fieldlayout";
%>
<%@ include file="logs-header.jsp" %>
<%
//Log Header end




mb.append("<table cellpadding=5 cellspacing=1 border=0 width=100% align=center>");


//Reset layout button
mb.append("<tr>");
mb.append("<td bgcolor=#e6e6e6 align=left colspan=2>");






//Main fields display
mb.append("<tr>");
mb.append("<td bgcolor=#ffffff align=left colspan=2>");
//Display the fields
mb.append(FieldLayout.getHtml(eventtypeid, 0, FieldLayout.LAYOUTMODEEDIT, userSession, "logs-type-fieldlayout.log", "logs-field.log", "logs-newfield.log", pageProps));
mb.append("</td>");
mb.append("</tr>");







mb.append("<!-- End column table -->");



mb.append("</table>");




mb.append("<br><br>");


//Log Footer start
%>
<%@ include file="logs-footer.jsp" %>
<%
//Log Footer end

%>

<%
/*----------------------------------------------------*/
/*                  Side Column                       */
        StringBuffer sc = new StringBuffer();
/*----------------------------------------------------*/
//sc.append("This is a ");
//sc.append("side column section.");

%>


<%@ include file="../globalfooter.jsp" %>
