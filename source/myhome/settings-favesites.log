<%@ page import="reger.core.db.Db"%>
<%
/*----------------------------------------------------*/
/*                  Page Config                       */
reger.pageFramework.PageProps pageProps = new reger.pageFramework.PageProps();
pageProps.siteSection=pageProps.ADMINSITE;
pageProps.title = "Favorite Sites";
pageProps.isPasswordProtected = true;
pageProps.navButtonName = "settingsfavesites";
pageProps.aclObjectName = "CUSTOMIZE";
pageProps.trafficType=reger.Vars.TRAFFICTYPEADMINMISC;
pageProps.pathToAppRoot="../";
/*----------------------------------------------------*/
%>

<%@ include file="../globalheader.jsp" %>

<%
/*----------------------------------------------------*/
/*                  Main Body                         */
        StringBuffer mb = new StringBuffer();
/*----------------------------------------------------*/



String errortext="";
String favesitetitle="";
if (userSession.getAccount().getFavesitetitle().equals("")){
	favesitetitle="My Favorite Sites";
} else {
    favesitetitle=userSession.getAccount().getFavesitetitle();
}

if (pageProps.action.equals("add")) {

	if (request.getParameter("name")!=null && !request.getParameter("name").equals("") && request.getParameter("url")!="" && !request.getParameter("url").equals("")) {
		//-----------------------------------
		//-----------------------------------
		int identity = Db.RunSQLInsert("INSERT INTO favesite(name, url, accountid) VALUES('"+ reger.core.Util.cleanForSQL(request.getParameter("name")) +"', '"+ reger.core.Util.cleanForSQL(request.getParameter("url")) +"', '"+ userSession.getAccount().getAccountid() +"')");
		//-----------------------------------
		//-----------------------------------

    } else {
		errortext="You must provide both a name and a URL. Thanks.";
    }
}


if (pageProps.action.equals("delete")) {
	//-----------------------------------
	//-----------------------------------
	int count = Db.RunSQLUpdate("DELETE FROM favesite WHERE accountid='"+ userSession.getAccount().getAccountid() +"' AND favesiteid='"+ request.getParameter("favesiteid") +"'");
	//-----------------------------------
	//-----------------------------------
}


if (pageProps.action.equals("editfavesitetitle")) {
	//-----------------------------------
	//-----------------------------------
	int count = Db.RunSQLUpdate("UPDATE account SET favesitetitle='"+ reger.core.Util.cleanForSQL(request.getParameter("favesitetitle")) +"' WHERE accountid='"+ userSession.getAccount().getAccountid() +"'");
	//-----------------------------------
	//-----------------------------------

    //Update the current session value
    userSession.getAccount().refresh();
	favesitetitle=request.getParameter("favesitetitle");
}


//Show any errors
if (!errortext.equals("")) {
	mb.append(reger.InfoBox.get(reger.InfoBox.BOXTYPEERROR, pageProps.pathToAppRoot, errortext));
}



mb.append("<table cellpadding=15 cellspacing=0 border=0>");
mb.append("<tr>");
mb.append("<td width=40% valign=top>");


mb.append("<table cellpadding=5 cellspacing=0 border=0>");

mb.append("<tr>");
mb.append("<td bgcolor=#cccccc>");
mb.append("<font face=arial size=+1>");
mb.append("Name your favorite sites list:");
mb.append("</font>");
mb.append("</td>");
mb.append("</tr>");

mb.append("<tr>");
mb.append("<td bgcolor=#e6e6e6>");

mb.append("<font face=arial size=-1>");
mb.append("<form action='settings-favesites.log' method=post>");
mb.append("<input type=hidden name=action value=editfavesitetitle>");
mb.append("<input type='text' name='favesitetitle' size='15' maxlength='49' value=\""+reger.core.Util.cleanForHtml(favesitetitle)+"\"> <input type='submit' value='Change'>");
mb.append("<br>");
mb.append("<font face=arial size=-2>This is the title of the box as it will appear on your homepage.  Go ahead... be creative.</font></form>");
mb.append("</font>");
mb.append("</td>");
mb.append("</tr>");


mb.append("<tr>");
mb.append("<td bgcolor=#cccccc>");
mb.append("<font face=arial size=+1>");
mb.append("Your list includes:");
mb.append("</font>");
mb.append("</td>");
mb.append("</tr>");


//-----------------------------------
//-----------------------------------
String[][] rstFaveSite= Db.RunSQL("SELECT favesiteid, url, name FROM favesite WHERE accountid='"+ userSession.getAccount().getAccountid() +"' ORDER BY name ASC");
//-----------------------------------
//-----------------------------------
if (rstFaveSite!=null && rstFaveSite.length>0){
	for(int i=0; i<rstFaveSite.length; i++){
		mb.append("<tr>");
        mb.append("<td>");
        mb.append("<font face=arial size=-1>");
        mb.append("(<a href='settings-favesites.log?action=delete&favesiteid="+rstFaveSite[i][0]+"'>Delete</a>) <a href='"+rstFaveSite[i][1]+"'>"+rstFaveSite[i][2]+"</a>");
        mb.append("</font>");
        mb.append("</td>");
        mb.append("</tr>");
	}
} else {
    mb.append("<tr>");
    mb.append("<td>");
    mb.append("<font face=arial size=-1>");
    mb.append("None.");
    mb.append("</font>");
    mb.append("</td>");
    mb.append("</tr>");
}


mb.append("<tr>");
mb.append("<td bgcolor=#cccccc>");
mb.append("<font face=arial size=+1>");
mb.append("Add a favorite site:");
mb.append("</font>");
mb.append("</td>");
mb.append("</tr>");

mb.append("</tr>");
mb.append("<td bgcolor=#e6e6e6>");
mb.append("<form action='settings-favesites.log' method=post>");
mb.append("<input type=hidden name=action value=add>");
mb.append("<font face=arial size=-1><strong>Site Name:</strong></font><br>");
mb.append("<input type='text' name='name' size='25' maxlength='49'>");
mb.append("<br><font face=arial size=-1><strong>Site URL:</strong></font><br>");
mb.append("<input type='text' name='url' size='25' maxlength='499' value='http://'>");
mb.append("<br>");
mb.append("<input type='submit' value='Add Site'>");
mb.append("</form>");
mb.append("</td>");
mb.append("</tr>");


mb.append("</table>");

mb.append("</td>");
mb.append("<td valign=top>");
mb.append("<font face=arial size=-1>");

mb.append("<strong>What is Favorites Sites?</strong>");
mb.append("<br>");
mb.append("Favorite Sites is a box that appears on the homepage of your site.");
mb.append("<br><br>");

mb.append("<strong>How are my Favorite Sites ordered?</strong>");
mb.append("<br>");
mb.append("Alphabetically by Site Name.");
mb.append("<br><br>");

mb.append("<strong>How do I turn it On or Off?</strong>");
mb.append("<br>");
mb.append("There's a setting on the main <a href='settings-siteprops.log'>Site Properties</a>.");
mb.append("<br><br>");

mb.append("<strong>Can everybody use it?</strong>");
mb.append("<br>");
mb.append("Everybody who's using <a href='accountstatus.log'>Pro</a>.");
mb.append("<br><br>");

mb.append("<strong>Can I change the way that it looks?</strong>");
mb.append("<br>");
mb.append("Yes.  You can use the CSS classes sidecolunit, sidecolheader and sodecolcontent to change the way that it looks.");
mb.append("<br><br>");

mb.append("<strong>How many Favorite Sites can I add?</strong>");
mb.append("<br>");
mb.append("An unlimited number.  Knock yourself out.");
mb.append("<br><br>");

mb.append("<strong>Can I edit a Favorite Site?</strong>");
mb.append("<br>");
mb.append("You can delete and re-add a site.");
mb.append("<br><br>");

mb.append("<strong>Who's responsible for the content linked to?</strong>");
mb.append("<br>");
mb.append("You are responsible for the content that you link to.  We assume no liability.");
mb.append("<br><br>");

mb.append("</font>");
mb.append("</td>");
mb.append("</tr>");
mb.append("</table>");




%>

<%
/*----------------------------------------------------*/
/*                  Side Column                       */
    StringBuffer sc = new StringBuffer();
/*----------------------------------------------------*/

//sc.append("This is a ");
//sc.append("side column section.");
%>


<%@ include file="../globalfooter.jsp" %>
