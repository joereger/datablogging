<%@ page import="reger.core.db.Db"%>
<%
/*----------------------------------------------------*/
/*                  Page Config                       */
reger.pageFramework.PageProps pageProps = new reger.pageFramework.PageProps();
pageProps.siteSection=pageProps.ADMINSITE;
pageProps.title = "Javascript Embedding";
pageProps.isPasswordProtected = true;
pageProps.navButtonName = "toolsjavascript";
pageProps.aclObjectName = "CUSTOMIZE";
pageProps.trafficType=reger.Vars.TRAFFICTYPEADMINMISC;
pageProps.pathToAppRoot="../";
/*----------------------------------------------------*/
%>

<%@ include file="../globalheader.jsp" %>

<%
/*----------------------------------------------------*/
/*                  Main Body                         */
        StringBuffer mb = new StringBuffer();
/*----------------------------------------------------*/


mb.append("<br><br>");

mb.append("<font face=arial size=-1>");
mb.append("You can put a list of your most recent entries onto any other site out there.  It's easy.  Just copy and paste the line below into the other site.");
mb.append("</font>");

mb.append("<br><br>");

mb.append("<table cellpadding=10 cellspacing=1 width=100% border=0>");
mb.append("<tr>");
mb.append("<td valign=top>");
mb.append("<font face=arial size=+1>");
mb.append("<strong>");
mb.append("Log:");
mb.append("</strong>");
mb.append("</font>");
mb.append("</td>");
mb.append("<td valign=top>");
mb.append("<font face=arial size=+1>");
mb.append("<strong>");
mb.append("Javascript:");
mb.append("</strong>");
mb.append("</font>");
mb.append("</td>");
mb.append("</tr>");


String baseScriptStart =  "<script language=\"JavaScript\" src=\""+reger.Vars.getHttpUrlPrefix()+userSession.getSiteRootUrl()+"/javascript.log";
String baseScriptEnd   =  "\"></script>";

String theScript = baseScriptStart + baseScriptEnd;
theScript = theScript.replaceAll("<", "&lt;");

mb.append("<tr>");
mb.append("<td valign=top bgcolor=#cccccc>");
mb.append("<font face=arial size=-1>");
mb.append("<strong>");
mb.append("All Logs");
mb.append("</strong>");
mb.append("</font>");
mb.append("</td>");
mb.append("<td valign=top bgcolor=#e6e6e6>");
mb.append("<font face=arial size=-1>");
mb.append("<strong>");
if (userSession.getAccount().isPro()) {
    mb.append(theScript);
} else {
    mb.append("<a href='accountstatus.log'><img src='../images/pro-only-in.gif' alt='' border='0'></a>");
}
mb.append("</strong>");
mb.append("</font>");
mb.append("</td>");
mb.append("</tr>");



//Only display logs that an accountuser explicitly has access to... in other words, an account owner may want to create a contributor who can't contribute to a particular public log.
String sql = "SELECT logid, name, eventtypeid, logaccess FROM megalog WHERE accountid='"+ userSession.getAccount().getAccountid() +"' AND "+userSession.getAccountuser().LogsUserCanAdministerQueryend(userSession.getAccount().getAccountid())+" ORDER BY name ASC";



//-----------------------------------
//-----------------------------------
String[][] rstEventtype= Db.RunSQL(sql);
//-----------------------------------
//-----------------------------------
if (rstEventtype!=null){
	for(int i=0; i<rstEventtype.length; i++){

	    theScript = baseScriptStart + "?logid=" + rstEventtype[i][0] + baseScriptEnd;
	    theScript = theScript.replaceAll("<", "&lt;");

	    //Output to the user
        mb.append("<tr>");
        mb.append("<td valign=top bgcolor=#cccccc>");
        mb.append("<font face=arial size=-1>");
        mb.append("<strong>");
        mb.append(rstEventtype[i][1]);
        mb.append("</strong>");
        mb.append("</font>");
        mb.append("</td>");
        mb.append("<td valign=top bgcolor=#e6e6e6>");
        mb.append("<font face=arial size=-1>");
        if (userSession.getAccount().isPro()) {
            mb.append(theScript);
        } else {
            mb.append("<a href='accountstatus.log'><img src='../images/pro-only-in.gif' alt='' border='0'></a>");
        }
        mb.append("</font>");
        mb.append("</td>");
        mb.append("</tr>");

    }
}




mb.append("</table>");

mb.append("<br><br>");



%>
<%
/*----------------------------------------------------*/
/*                  Side Column                       */
        StringBuffer sc = new StringBuffer();
/*----------------------------------------------------*/

//sc.append("This is a ");
//sc.append("side column section.");
%>


<%@ include file="../globalfooter.jsp" %>
