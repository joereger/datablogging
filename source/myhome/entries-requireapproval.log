<%@ page import="reger.core.Util,
                 reger.core.db.Db,
                 reger.Help"%>
<%
/*----------------------------------------------------*/
/*                  Page Config                       */
reger.pageFramework.PageProps pageProps = new reger.pageFramework.PageProps();
pageProps.siteSection=pageProps.ADMINSITE;
pageProps.title = "Entries Requiring Approval";
pageProps.isPasswordProtected = true;
pageProps.navButtonName = "entries";
pageProps.aclObjectName = "APPROVEENTRIES";
pageProps.trafficType=reger.Vars.TRAFFICTYPEADMINMISC;
pageProps.pathToAppRoot="../";
/*----------------------------------------------------*/
%>

<%@ include file="../globalheader.jsp" %>

<%
/*----------------------------------------------------*/
/*                  Main Body                         */
        StringBuffer mb = new StringBuffer();
/*----------------------------------------------------*/

//Approval entries start

mb.append("<br>");

mb.append("<!-- Start Approval List -->");
String helpApprove = Help.tip("Approval Required", "These entries require approval.  Your account has approval privileges.  To approve an entry, click on it, choose to approve it near the bottom of the edit screen and then click Edit Log Entry to finish.<br><br>Using the approval capability is a great way to get other authors to add content to your site while making sure that you get to review what they write before the public sees it.<br><br>You set up approval when you control an author's permissions in the People section.", false, pageProps.pathToAppRoot);
mb.append(reger.ui.BubbleBox.start("Approval Required " + helpApprove, pageProps.pathToAppRoot));
mb.append("<table width=100% cellpadding=0 cellspacing=1 border=0>");
//mb.append("<tr><td bgcolor=#666666 colspan=5><font face=arial size=+1 color=#ffffff><strong>Approval Required</strong></font></td></tr>");
mb.append("<tr>");
mb.append("<td bgcolor=#e6e6e6 valign=top colspan=2 align=left>");
mb.append("<font face=arial size=-2 color=#666666>Title</font></a></td>");
mb.append("<td bgcolor=#e6e6e6 valign=top align=left>");
mb.append("<font face=arial size=-2 color=#666666>");
mb.append("Date");
mb.append("</font>");
mb.append("</td>");
mb.append("<td bgcolor=#e6e6e6 valign=top align=left>");
mb.append("<font face=arial size=-2 color=#666666>");
mb.append("Log");
mb.append("</font>");
mb.append("</td>");
mb.append("<td bgcolor=#e6e6e6 valign=top align=left>");
mb.append("<font face=arial size=-2 color=#666666>");
mb.append("Author");
mb.append("</font>");
mb.append("</td>");
mb.append("</tr>");
//-----------------------------------
//-----------------------------------
String[][] rstApprovals= Db.RunSQL("SELECT eventid, event.eventtypeid, title, date, name, accountuser.friendlyname FROM event, megalog, accountuser WHERE event.accountuserid=accountuser.accountuserid AND event.accountid='"+ userSession.getAccount().getAccountid() +"' AND event.isapproved='0' AND event.istemporary='0' AND megalog.logid=event.logid AND "+userSession.getAccountuser().LogsUserCanAdministerQueryend(userSession.getAccount().getAccountid())+" ORDER BY date DESC");
//-----------------------------------
//-----------------------------------
if (rstApprovals!=null && rstApprovals.length>0){
    for(int i=0; i<rstApprovals.length; i++){
        mb.append("<tr>");
        mb.append("<td bgcolor=#ffffff valign=top align=right width=10><a href='log-" + rstApprovals[i][1] + ".log?eventid=" + rstApprovals[i][0] + "&action=edit'><img src='../images/bullet-arrow.gif' width='9' height='9' alt='' border='0'></a>");
        mb.append("</td>");
        mb.append("<td bgcolor=#ffffff valign=top align=left>");
        mb.append("<a href='entry.log?eventid=" + rstApprovals[i][0] + "&action=edit'><font face=arial size=-2>" + reger.core.Util.cleanForHtml(rstApprovals[i][2]) + "</font></a></td>");
        mb.append("<td bgcolor=#ffffff valign=top align=left>");
        mb.append("<font face=arial size=-2>");
        mb.append(reger.core.TimeUtils.agoText(reger.core.TimeUtils.dbstringtocalendar(rstApprovals[i][3])));
        mb.append("</font>");
        mb.append("</td>");
        mb.append("<td bgcolor=#ffffff valign=top align=left>");
        mb.append("<font face=arial size=-2>");
        mb.append(" " + rstApprovals[i][4]);
        mb.append("</font>");
        mb.append("</td>");
        mb.append("<td bgcolor=#ffffff valign=top align=left>");
        mb.append("<font face=arial size=-2>");
        mb.append(" " + rstApprovals[i][5]);
        mb.append("</font>");
        mb.append("</td>");
        mb.append("</tr>");
    }
} else {
    mb.append("<tr><td bgcolor=#ffffff valign=top colspan=5>");
    mb.append("<font face=arial size=-2>No entries currently require your approval.  Entries require approval when you have a contributing author for the site who does not have publish permission.  Add new authors in the <a href='people-authors.log'>People</a> section.</font>");
    mb.append("</td></tr>");
}
mb.append("</table>");
mb.append(reger.ui.BubbleBox.end(pageProps.pathToAppRoot));
mb.append("<!-- End Approval List -->");
//Approvals entries end


%>

<%
/*----------------------------------------------------*/
/*                  Side Column                       */
    StringBuffer sc = new StringBuffer();
/*----------------------------------------------------*/

//sc.append("This is a ");
//sc.append("side column section.");
%>


<%@ include file="../globalfooter.jsp" %>
