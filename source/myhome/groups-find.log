<%@ page import="reger.core.db.Db,
                 org.apache.xmlrpc.XmlRpcClient,
                 java.util.Vector,
                 java.util.Hashtable,
                 reger.core.db.Db"%>
<%@ page import="reger.core.Debug"%>
<%@ page import="reger.groups.Group"%>
<%
/*----------------------------------------------------*/
/*                  Page Config                       */
reger.pageFramework.PageProps pageProps = new reger.pageFramework.PageProps();
pageProps.siteSection=pageProps.ADMINSITE;
pageProps.title = "Find Groups";
pageProps.isPasswordProtected = true;
pageProps.navButtonName = "groups";
pageProps.aclObjectName = "MANAGEGROUPS";
pageProps.trafficType=reger.Vars.TRAFFICTYPEADMINMISC;
pageProps.pathToAppRoot="../";
/*----------------------------------------------------*/
%>

<%@ include file="../globalheader.jsp" %>

<%

/*----------------------------------------------------*/
/*                  Main Body                         */
        StringBuffer mb = new StringBuffer();
/*----------------------------------------------------*/


mb.append(reger.ui.BubbleBox.start("Search Groups", pageProps.pathToAppRoot));
if (request.getParameter("searchterms")==null || request.getParameter("searchterms").equals("")){
    mb.append(reger.InfoBox.get(reger.InfoBox.BOXTYPEINFO, pageProps.pathToAppRoot, "Please provide search terms to search groups."));
}
mb.append("<br>");
mb.append("<form action='groups-find.log' method=post>");
mb.append("<input type=hidden name=action value='searchgroups'>");
String sbtext = "";
if (request.getParameter("searchterms")!=null){
    sbtext = request.getParameter("searchterms");
}
mb.append("<input type=textbox name=searchterms value=\""+reger.core.Util.cleanForHtml(sbtext)+"\" size=35 maxlength=255>");
mb.append("<input type=submit value='Search for Groups'>");
mb.append("</form>");
mb.append(reger.ui.BubbleBox.end(pageProps.pathToAppRoot));


if (pageProps.action.equals("searchgroups") && request.getParameter("searchterms")!=null && !request.getParameter("searchterms").equals("")){

        mb.append(reger.ui.BubbleBox.start("Search Results", pageProps.pathToAppRoot));

        mb.append("<table cellpadding=5 cellspacing=2 border=0>");


        //-----------------------------------
        //-----------------------------------
        String[][] rstData= reger.core.db.Db.RunSQL("SELECT groupid FROM groups, pl WHERE ((groups.name LIKE '%"+reger.core.Util.cleanForSQL(request.getParameter("searchterms"))+"%') OR (groups.description LIKE '%"+reger.core.Util.cleanForSQL(request.getParameter("searchterms"))+"%')) AND groups.plid=pl.plid AND " + userSession.getPl().getPeerSql() + " LIMIT 0,100");
        //-----------------------------------
        //-----------------------------------
        if (rstData!=null && rstData.length>0){
            for(int i=0; i<rstData.length; i++){

                Group group = new Group(Integer.parseInt(rstData[i][0]));


                mb.append("<tr>");



//                int totalEntries = 0;
//                if (o.get("totalEntries")!=null){
//                    totalEntries = ((Integer)o.get("totalEntries")).intValue();
//                }


                mb.append("<td valign=top>");
                mb.append("<a href='"+pageProps.pathToAppRoot+"myhome/group-view.log?groupid="+group.getGroupid()+"'>");
                mb.append("<font face=arial size=-1>");
                mb.append("<strong>");
                mb.append(group.getName());
                mb.append("</strong>");
                mb.append("</font>");
                mb.append("</a>");
//                mb.append(" <font face=arial size=-2>( ");
//                mb.append(totalEntries);
//                if (totalEntries==1){
//                    mb.append(" Entry");
//                } else {
//                    mb.append(" Entries");
//                }
//                mb.append(" )</font>");
                mb.append("<br>");
                mb.append("<font face=arial size=-2>");
                mb.append(group.getDescription());
                mb.append("</font>");
                mb.append("</td>");

                mb.append("<td valign=top align=center>");
                mb.append("<font face=arial size=-2>");
                if (group.getEntriesareprivate()){
                    mb.append("<img src='../images/icon-private.gif' width='16' height='16' alt='' border='0'><br>Private Reading");
                } else {
                    mb.append("<img src='../images/icon-public.gif' width='16' height='16' alt='' border='0'><br>Public Reading");
                }
                mb.append("</font>");
                mb.append("</td>");

                mb.append("<td valign=top align=center>");
                mb.append("<font face=arial size=-2>");
                if (group.getMembershipismoderated()){
                    mb.append("<img src='../images/icon-private.gif' width='16' height='16' alt='' border='0'><br>Membership must be approved");
                } else {
                    mb.append("<img src='../images/icon-public.gif' width='16' height='16' alt='' border='0'><br>Anybody may join");
                }
                mb.append("</font>");
                mb.append("</td>");


                mb.append("<td valign=top align=center>");
                mb.append("<font face=arial size=-2>");
                mb.append("<a href='groups-join.log?action=join&groupid="+group.getGroupid()+"'>");
                mb.append("<img src='../images/plus-icon.gif' border=0>");
                mb.append("<br>");
                mb.append("Join Group");
                mb.append("</a>");
                mb.append("</font>");
                mb.append("</td>");


                mb.append("</tr>");


            }
        }

        mb.append("</table>");

        mb.append(reger.ui.BubbleBox.end(pageProps.pathToAppRoot));






}


%>

<%
/*----------------------------------------------------*/
/*                  Side Column                       */
    StringBuffer sc = new StringBuffer();
/*----------------------------------------------------*/

//sc.append("This is a ");
//sc.append("side column section.");
%>


<%@ include file="../globalfooter.jsp" %>
