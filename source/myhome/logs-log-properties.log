<%@ page import="reger.core.db.Db,
                 reger.core.Util,
                 java.util.TreeMap,
                 reger.mega.FieldType,
                 reger.mega.FieldLayout,
                 reger.Log,
                 reger.template.Template,
                 reger.core.Util"%>
<%
/*----------------------------------------------------*/
/*                  Page Config                       */
reger.pageFramework.PageProps pageProps = new reger.pageFramework.PageProps();
pageProps.siteSection=pageProps.ADMINSITE;
pageProps.title = "Customize Log Properties";
pageProps.isPasswordProtected = true;
pageProps.navButtonName = "logsyourlogs";
pageProps.aclObjectName = "CUSTOMIZELOG";
pageProps.trafficType=reger.Vars.TRAFFICTYPEADMINMISC;
pageProps.pathToAppRoot="../";
//pageProps.isLogidRequired=true;
/*----------------------------------------------------*/
%>

<%@ include file="../globalheader.jsp" %>

<%
/*----------------------------------------------------*/
/*                  Main Body                         */
        StringBuffer mb = new StringBuffer();
/*----------------------------------------------------*/



//Load the log
reger.Log log = LogCache.get(pageProps.logProps.logid);

boolean saved = false;
if (pageProps.action.equals("go")) {

    if (request.getParameter("name")!=null && !request.getParameter("name").equals("")){
        log.setName(request.getParameter("name"));
    }
    if (request.getParameter("message")!=null && !request.getParameter("message").equals("")){
        log.setMessage(request.getParameter("message"));
    } else {
        log.setMessage("");
    }
    if (request.getParameter("logaccess")!=null && !request.getParameter("logaccess").equals("")){
        log.setLogaccess(Integer.parseInt(request.getParameter("logaccess")));
    } else {
        log.setLogaccess(reger.Vars.LOGACCESSPRIVATE);
    }
    if (request.getParameter("showonhomepage")!=null && !request.getParameter("showonhomepage").equals("")){
        if(request.getParameter("showonhomepage").equals("1")){
            log.setShowonhomepage(true);
        } else {
            log.setShowonhomepage(false);
        }
    }
    if (request.getParameter("password")!=null && !request.getParameter("password").equals("")){
        log.setPassword(request.getParameter("password"));
    } else {
        log.setPassword("");
    }
    if (request.getParameter("customdomain1")!=null && !request.getParameter("customdomain1").equals("")){
        log.setCustomdomain1(request.getParameter("customdomain1"));
    } else {
        log.setCustomdomain1("");
    }
    if (request.getParameter("customdomain2")!=null && !request.getParameter("customdomain2").equals("")){
        log.setCustomdomain2(request.getParameter("customdomain2"));
    } else {
        log.setCustomdomain2("");
    }
    if (request.getParameter("customdomain3")!=null && !request.getParameter("customdomain3").equals("")){
        log.setCustomdomain3(request.getParameter("customdomain3"));
    } else {
        log.setCustomdomain3("");
    }

    //Save
    log.save();
    userSession.getAccount().refresh();
    saved=true;

}

//Log Header start
String currentNavButtonName = "logs-log-properties";
%>
<%@ include file="logs-header.jsp" %>
<%
//Log Header end

if (saved){
    mb.append(reger.InfoBox.get(reger.InfoBox.BOXTYPECOMPLETE, pageProps.pathToAppRoot, "Saved!"));
}


mb.append("<form action='logs-log-properties.log' method=post>");
mb.append("<input type=hidden name=action value=go>");
mb.append("<input type=hidden name=logid value="+pageProps.logProps.logid+">");
mb.append("<input type=hidden name=eventtypeid value=0>");


mb.append("<table cellpadding=5 cellspacing=1 border=0 width=100% align=center>");


mb.append("<tr>");
mb.append("<td valign=top align=left ><input type=text name=name value=\""+Util.cleanForHtml(log.getName())+"\"></td>");
mb.append("<td valign=top align=left bgcolor='#ffffff'><font face=arial size=-1><strong>Log Name</strong></font><br><font face=arial size=-2><strong>This is the name that appears on your public log.</strong></font></td>");
mb.append("</tr>");

//mb.append("<tr>");
//mb.append("<td valign=top align=left bgcolor='#eeeeee'><textarea name=message cols='25' rows='3'>"+log.getMessage()+"</textarea></td>");
//mb.append("<td valign=top align=left bgcolor='#ffffff'><font face=arial size=-1><strong>Log Message</strong></font></td>");
//mb.append("</tr>");

mb.append("<tr>");
mb.append("<td valign=top align=left >");
//Radio Control
TreeMap radiosPasswordProtection=new TreeMap();
radiosPasswordProtection.put(String.valueOf(reger.Vars.LOGACCESSPUBLIC),"<img src='../images/icon-public.gif' border=0> Public");
radiosPasswordProtection.put(String.valueOf(reger.Vars.LOGACCESSPRIVATE),"<img src='../images/icon-private.gif' border=0> Private");
mb.append(reger.formControl.radioList(radiosPasswordProtection, String.valueOf(log.getLogaccess()), "logaccess", "vertical"));
//End Radio Control
mb.append("</td>");
mb.append("<td  valign=top align=left>");
mb.append("<font face=arial size=-1><strong>Log Security:</strong></font><br><font face=arial size=-2><strong>Determines whether this log is password-protected or open to the public.  Once you password-protect a log your users must register and you must manually allow them to view this log.  Or they can use the Quick Password if you assign one.</strong></font></td>");
mb.append("</tr>");

mb.append("<tr>");
mb.append("<td valign=top align=left ><input type=text name=password value=\""+Util.cleanForHtml(log.getPassword())+"\"></td>");
mb.append("<td valign=top align=left bgcolor='#ffffff'><font face=arial size=-1><strong>QuickLogin Password:</strong></font><br><font face=arial size=-2><strong>If you make your log private then users will need to register before they can see it.  This is cumbersome if you intend to share your private log with a large (but private) group of friends or family.  So we created the QuickLogin Password.  You can distribute the QuickLogin Password and users will be able to use it to see your log without registering.  Leave blank if you're unsure or if you don't need a QuickLogin Password.  Tell people to click login and enter their QuickLogin Password.</strong></font></td>");
mb.append("</tr>");

mb.append("<tr>");
mb.append("<td valign=top align=left >");
//Radio Control
String showHpText = "1";
if (!log.getShowonhomepage()){
    showHpText="0";
}
TreeMap radiosShowOnHp=new TreeMap();
radiosShowOnHp.put("1","<img src='../images/home-visible.gif' border=0> Visible");
radiosShowOnHp.put("0","<img src='../images/home-hidden.gif' border=0> Hidden");
mb.append(reger.formControl.radioList(radiosShowOnHp, showHpText, "showonhomepage", "vertical"));
//End Radio Control
mb.append("</td>");
mb.append("<td  valign=top align=left>");
mb.append("<font face=arial size=-1><strong>Visible on Homepage?</strong></font><br><font face=arial size=-2><strong>Your web log homepage is an important place.  It's the place where your visitors get their first glimpse of you and where they find updates.  Sometimes you want to keep track of things and keep them public, but you don't necessarily want them to take up space on your homepage.  This allows you to have a log's entries not appear on the home page.  Note: This is different than making a log private.  By deciding to not show on the homepage you are not restricting access to the log... you are just making users click the log directly before they see its log entries.  We hope this makes sense.  If not, play around with it a bit.  You can always switch it back.</strong></font></td>");
mb.append("</tr>");



mb.append("<tr>");
mb.append("<td valign=top align=left ><input type=text name=customdomain1 value=\""+Util.cleanForHtml(log.getCustomdomain1())+"\"></td>");
mb.append("<td valign=top align=left bgcolor='#ffffff'><font face=arial size=-1><strong>Custom Domain 1:</strong></font><br><font face=arial size=-2><strong>Assign a unique domain name to this specific log.  Example: work.joereger.com</strong></font></td>");
mb.append("</tr>");

mb.append("<tr>");
mb.append("<td valign=top align=left ><input type=text name=customdomain2 value=\""+Util.cleanForHtml(log.getCustomdomain2())+"\"></td>");
mb.append("<td valign=top align=left bgcolor='#ffffff'><font face=arial size=-1><strong>Custom Domain 2</strong></font><br><font face=arial size=-2><strong></strong></font></td>");
mb.append("</tr>");


mb.append("<tr>");
mb.append("<td valign=top align=left ><input type=text name=customdomain3 value=\""+Util.cleanForHtml(log.getCustomdomain3())+"\"></td>");
mb.append("<td valign=top align=left bgcolor='#ffffff'><font face=arial size=-1><strong>Custom Domain 3</strong></font><br><font face=arial size=-2><strong></strong></font></td>");
mb.append("</tr>");



mb.append("<tr>");
mb.append("<td align=center><input class=\"btn btn-primary btn-large\" type='submit' value='Save Properties'></td>");
mb.append("<td  align=center></td>");
mb.append("</tr>");

mb.append("</form>");


mb.append("<!-- End column table -->");



mb.append("</table>");




mb.append("<br><br>");


//Log Footer start
%>
<%@ include file="logs-footer.jsp" %>
<%
//Log Footer end

%>

<%
/*----------------------------------------------------*/
/*                  Side Column                       */
        StringBuffer sc = new StringBuffer();
/*----------------------------------------------------*/
//sc.append("This is a ");
//sc.append("side column section.");

%>


<%@ include file="../globalfooter.jsp" %>
