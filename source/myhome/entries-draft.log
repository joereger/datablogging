<%@ page import="reger.core.Util,
                 reger.core.db.Db"%>
<%
/*----------------------------------------------------*/
/*                  Page Config                       */
reger.pageFramework.PageProps pageProps = new reger.pageFramework.PageProps();
pageProps.siteSection=pageProps.ADMINSITE;
pageProps.title = "Draft Entries";
pageProps.isPasswordProtected = true;
pageProps.navButtonName = "entriesdraft";
pageProps.aclObjectName = "ADDEDITENTRIES";
pageProps.trafficType=reger.Vars.TRAFFICTYPEADMINMISC;
pageProps.pathToAppRoot="../";
pageProps.helpText="This page helps you find old entries so that you can edit, delete or move them.<br><br>Enter a search term and click Search or browse your most recent entries.";
/*----------------------------------------------------*/
%>

<%@ include file="../globalheader.jsp" %>

<%
/*----------------------------------------------------*/
/*                  Main Body                         */
        StringBuffer mb = new StringBuffer();
/*----------------------------------------------------*/



 mb.append("<div class=\"row\">");
    mb.append("<div class=\"col-md-6\">");


//Draft entries start
    mb.append("<!-- Start Draft List -->");
    mb.append("<table class=\"table table-striped\">");

    //-----------------------------------
    //-----------------------------------
    String[][] rstDrafts= reger.core.db.Db.RunSQL("SELECT eventid, event.eventtypeid, title, date, name, accountuser.friendlyname FROM event, megalog, accountuser WHERE event.accountuserid=accountuser.accountuserid AND event.accountid='"+ userSession.getAccount().getAccountid() +"' AND event.isdraft='1' AND megalog.logid=event.logid AND "+userSession.getAccountuser().LogsUserCanAdministerQueryend(userSession.getAccount().getAccountid())+" ORDER BY date DESC");
    //-----------------------------------
    //-----------------------------------
    if (rstDrafts!=null && rstDrafts.length>0){
        for(int i=0; i<rstDrafts.length; i++){
            mb.append("<tr>");

            mb.append("<td><strong>"+reger.core.Util.truncateString(reger.core.Util.cleanForHtml(rstDrafts[i][2]), 100)+"</strong><br/><h6>"+reger.core.TimeUtils.agoText(reger.core.TimeUtils.dbstringtocalendar(rstDrafts[i][3]))+"</h6></td>");

            mb.append("<td style=\"width:100px;\" nowrap>");
            mb.append("<div class=\"btn-group\">" + "\n");
            mb.append("<a class=\"btn btn-success\" href=\"entry.log?eventid="+rstDrafts[i][0]+"&action=edit\"><i class=\"icon-edit icon-white\"></i> Edit</a>" + "\n");
            mb.append("<a class=\"btn dropdown-toggle\" data-toggle=\"dropdown\" href=\"#\">" + "\n");
            mb.append("<span class=\"caret\"></span>" + "\n");
            mb.append("</a>" + "\n");
            mb.append("<ul class=\"dropdown-menu\">" + "\n");
            mb.append("<li><a href=\"../entry.log?eventid="+rstDrafts[i][0]+"\">View</a></li>" + "\n");
            mb.append("<li><a href=\"entry-move.log?eventid="+rstDrafts[i][0]+"\">Move</a></li>" + "\n");
            mb.append("<li><a href=\"entry-delete.log?eventid="+rstDrafts[i][0]+"\">Delete</a></li>" + "\n");
            mb.append("</ul>" + "\n");
            mb.append("</div>" + "\n");
            mb.append("</td>");

            mb.append("</tr>");

        }
    } else {
        mb.append("<tr><td bgcolor=#ffffff valign=top colspan=5>");
        mb.append("<font face=arial size=-2>None</font>");
        mb.append("</td></tr>");
    }
    mb.append("</table>");
    mb.append("<!-- End Draft List -->");
    //Draft entries end



    mb.append("</div>");
    mb.append("</div>");





%>

<%
/*----------------------------------------------------*/
/*                  Side Column                       */
    StringBuffer sc = new StringBuffer();
/*----------------------------------------------------*/

//sc.append("This is a ");
//sc.append("side column section.");
%>


<%@ include file="../globalfooter.jsp" %>
