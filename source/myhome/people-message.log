<%@ page import="reger.core.db.Db"%>
<%
/*----------------------------------------------------*/
/*                  Page Config                       */
reger.pageFramework.PageProps pageProps = new reger.pageFramework.PageProps();
pageProps.siteSection=pageProps.ADMINSITE;
pageProps.title = "Message";
pageProps.isPasswordProtected = true;
pageProps.navButtonName = "peopleinbox";
pageProps.aclObjectName = "PEOPLE";
pageProps.trafficType=reger.Vars.TRAFFICTYPEADMINMISC;
pageProps.pathToAppRoot="../";
/*----------------------------------------------------*/
%>

<%@ include file="../globalheader.jsp" %>

<%

/*----------------------------------------------------*/
/*                  Main Body                         */
        StringBuffer mb = new StringBuffer();
/*----------------------------------------------------*/

//Get the details of the message
reger.FriendMessage message = new reger.FriendMessage();
if (request.getParameter("friendmessageid")!=null && reger.core.Util.isinteger(request.getParameter("friendmessageid"))){
    message = new reger.FriendMessage(Integer.parseInt(request.getParameter("friendmessageid")));
}

//-----------------------------------
//-----------------------------------
String[][] rstRecip= reger.core.db.Db.RunSQL("SELECT friendmessagerecipientid FROM friendmessagerecipient WHERE friendmessageid='"+message.friendmessageid+"' AND accountuserid='"+userSession.getAccountuser().getAccountuserid()+"'");
//-----------------------------------
//-----------------------------------
if (rstRecip!=null && rstRecip.length>0){
    for(int i=0; i<rstRecip.length; i++){
        //-----------------------------------
        //-----------------------------------
        int count = Db.RunSQLUpdate("UPDATE friendmessagerecipient SET isread='1' WHERE friendmessagerecipientid='"+rstRecip[i][0]+"'");
        //-----------------------------------
        //-----------------------------------
    }
} else {
    response.sendRedirect("people-inbox.log");
    return;
}






//Display the page

mb.append(reger.ui.BubbleBox.start("", pageProps.pathToAppRoot));

mb.append("<table cellpadding=3 cellspacing=0 width=100% border=0>");

mb.append("<tr>");
mb.append("<td valign=top>");
mb.append(reger.ui.BubbleBox.start("", pageProps.pathToAppRoot));
mb.append("<font face=arial size=-2><b>");
mb.append("<a href='people-inbox.log'>Inbox</a>");
mb.append("<br>");
mb.append("<a href='people-newmessage.log'>Send New Message</a>");
mb.append("<br>");
mb.append("</b></font>");
mb.append(reger.ui.BubbleBox.end(pageProps.pathToAppRoot));
mb.append("</td>");
mb.append("<td valign=top>");


mb.append(reger.ui.BubbleBox.start("Subject:" + message.subject, pageProps.pathToAppRoot));


mb.append("<div class=yellowbox>");
mb.append("<font face=arial size=-2 color=#666666>");
mb.append("From: ");
mb.append("</font>");
reger.Accountuser friend = new reger.Accountuser(message.accountuserid, true);
mb.append("<font face=arial size=-2 color=#666666>");
mb.append("<img src='"+friend.primaryImage(userSession, true)+"' width=35 border=0 align=top>");
mb.append(friend.getFriendlyname());
mb.append("</div>");


//Relationship
//mb.append(reger.ui.BubbleBox.start("Your Relationship to " + friend.getFriendlyname() + ":", pageProps.pathToAppRoot));
//Get the relationship between the two
mb.append("<div class=yellowbox>");
mb.append("<font face=arial size=-2 color=#666666>");
mb.append("Your Relationship:<br>");
mb.append(userSession.getAccountuser().htmlAllRelationshipsToPerson(friend.getAccountuserid(), userSession));
mb.append("</font>");
mb.append("</div>");
//mb.append(reger.ui.BubbleBox.end(pageProps.pathToAppRoot));

//mb.append(reger.ui.BubbleBox.start("Subject:", pageProps.pathToAppRoot));
//mb.append("<br>");
//mb.append("<font face=arial size=+1 color=#666666>");
//mb.append(message.subject);
//mb.append("</font>");
//mb.append(reger.ui.BubbleBox.end(pageProps.pathToAppRoot));

//mb.append(reger.ui.BubbleBox.start("Message:", pageProps.pathToAppRoot));
mb.append("<br>");
mb.append("<font face=arial size=-1 color=#666666>");
mb.append(message.message);
mb.append("</font>");
//mb.append(reger.ui.BubbleBox.end(pageProps.pathToAppRoot));


mb.append(reger.ui.BubbleBox.end(pageProps.pathToAppRoot));


mb.append("</td>");
mb.append("</tr>");

mb.append("</table>");

mb.append(reger.ui.BubbleBox.end(pageProps.pathToAppRoot));





%>

<%
/*----------------------------------------------------*/
/*                  Side Column                       */
    StringBuffer sc = new StringBuffer();
/*----------------------------------------------------*/

//sc.append("This is a ");
//sc.append("side column section.");
%>


<%@ include file="../globalfooter.jsp" %>
