<%@ page import="reger.poll.PollUtil"%>
<%
    /*----------------------------------------------------*/
/*                  Page Config                       */
    reger.pageFramework.PageProps pageProps = new reger.pageFramework.PageProps();
    pageProps.siteSection = pageProps.ADMINSITE;
    pageProps.title = "Edit Poll";
    pageProps.isPasswordProtected = true;
    pageProps.navButtonName = "entriespolls";
    pageProps.aclObjectName = "ADDEDITENTRIES";
    pageProps.trafficType = reger.Vars.TRAFFICTYPEADMINMISC;
    pageProps.pathToAppRoot = "../";
/*----------------------------------------------------*/
%>

<%@ include file="../globalheader.jsp" %>

<%
    /*----------------------------------------------------*/
/*                  Main Body                         */
    StringBuffer mb = new StringBuffer();
/*----------------------------------------------------*/
    if (request.getParameter("submit") != null) {
          PollUtil pollUtil = new PollUtil();
          pollUtil.savePoll(request);
    } else {
        if (request.getParameter("eventid") != null && reger.core.Util.isinteger(request.getParameter("eventid"))) {
            pageProps.entry.getEntryAll(Integer.parseInt(request.getParameter("eventid")));
        }
        mb.append("<SCRIPT language=JavaScript>");
        mb.append("function submitForm() {");
        mb.append("document.pollForm.submit()");
        mb.append("}</SCRIPT>");
        mb.append("<form name=pollForm action=entries-poll-settings.log method=post>");
        mb.append("<table><tr><td>");
        mb.append(reger.ui.BubbleBox.start("", pageProps.pathToAppRoot));
        mb.append("<center><table>");
        mb.append("<tr><td>Question:</td>");
        String value = request.getParameter("question");
        if (value == null) {
            mb.append("<td><input type=text name=question></td>");
        } else {
            mb.append("<td><input type=text name=question value="+value+"></td>");
        }
        mb.append("</tr>");
        mb.append("<tr><td>Answers:</td>");
        int noOfTextFields = 0;
        if (request.getParameter("noOfTextFields") == null) {
            noOfTextFields = 0;
        } else {
            noOfTextFields = Integer.parseInt(request.getParameter("noOfTextFields"));
        }
        noOfTextFields += 5;
        for (int i=1;i<=noOfTextFields;i++) {
            value = request.getParameter("answer"+i);
            if (i != 1) {
               mb.append("<tr><td></td>");
            }
            if (value == null) {
                mb.append("<td><input type=text name=answer"+i+"></td>");
            } else {
                mb.append("<td><input type=text name=answer"+i+" value="+value+"></td>");
            }
            mb.append("</tr>");
        }
        mb.append("<input type=hidden name=noOfTextFields value="+noOfTextFields+">");
        mb.append("<input type=hidden name=eventid value="+request.getParameter("eventid")+">");
        mb.append("<tr><td></td><td><a href=\"javascript: submitForm()\">add more >> </a></td>");
        mb.append("</tr>");
        mb.append("<tr><td>Reader Answers:</td>");
        value = request.getParameter("readerscanaddownanswer");
        if (value == null) {
            mb.append("<td><input type=checkbox name=readerscanaddownanswer> Yes, readers can add their own answers.</td>");
        } else if (value.equalsIgnoreCase("on")) {
            mb.append("<td><input type=checkbox name=readerscanaddownanswer value=checked> Yes, readers can add their own answers.</td>");
        }
        mb.append("</tr>");
        mb.append("<tr><td>Reader Comments:</td>");
        value = request.getParameter("readerscanaddcomments");
        if (value == null) {
            mb.append("<td><input type=checkbox name=readerscanaddcomments> Yes, readers can add comments.</td>");
        } else if (value.equalsIgnoreCase("on")) {
            mb.append("<td><input type=checkbox name=readerscanaddcomments value=checked> Yes, readers can add comments.</td>");
        }
        mb.append("</tr>");
        mb.append("<tr><td></td>");
        value = request.getParameter("readerscanvoteonreaderanswers");
        if (value == null) {
            mb.append("<td>If Yes: <input type=checkbox name=readerscanvoteonreaderanswers> Readers can vote on each others answers.</td>");
        } else if (value.equalsIgnoreCase("on")) {
            mb.append("<td>If Yes: <input type=checkbox name=readerscanvoteonreaderanswers value=checked> Readers can vote on each others answers.</td>");
        }
        mb.append("</tr>");
        mb.append("<tr><td>Moderation:</td>");
        value = request.getParameter("readerinputismoderated");
        if (value == null) {
            mb.append("<td><input type=checkbox name=readerinputismoderated> Readers comments and answers must be approved.</td>");
        } else if (value.equalsIgnoreCase("on")) {
            mb.append("<td><input type=checkbox name=readerinputismoderated value=checked> Readers comments and answers must be approved.</td>");
        }
        mb.append("</tr>");
        mb.append("</table></center>");
        mb.append(reger.ui.BubbleBox.end(pageProps.pathToAppRoot));
        mb.append("</td>");

        mb.append("<td>");
        mb.append(reger.ui.BubbleBox.start("", pageProps.pathToAppRoot));
        mb.append("Poll is tied to entry called <a href=../entry.log?eventid=" + pageProps.entry.eventid + ">" + pageProps.entry.title + "</a>");
        mb.append(reger.ui.BubbleBox.end(pageProps.pathToAppRoot));
        mb.append("<br>");

        mb.append(reger.ui.BubbleBox.start("", pageProps.pathToAppRoot));
        mb.append("<input type=submit name=submit value=Open>&nbsp;<input type=submit name=submit value=Closed>");
        mb.append(reger.ui.BubbleBox.end(pageProps.pathToAppRoot));
        mb.append("<br>");

        mb.append(reger.ui.BubbleBox.start("", pageProps.pathToAppRoot));
        mb.append("<u>View Results</u>");
        mb.append(reger.ui.BubbleBox.end(pageProps.pathToAppRoot));
        mb.append("<br>");

        mb.append(reger.ui.BubbleBox.start("", pageProps.pathToAppRoot));
        mb.append("Moderation<br>");
        mb.append("These answers from users need to be approved");
        mb.append(reger.ui.BubbleBox.end(pageProps.pathToAppRoot));
        mb.append("<br>");

        mb.append(reger.ui.BubbleBox.start("", pageProps.pathToAppRoot));
        mb.append("These comments need to be approved");
        mb.append(reger.ui.BubbleBox.end(pageProps.pathToAppRoot));
        mb.append("</td></tr>");
        mb.append("<tr><td><input type=submit value=Save name=submit></td></tr>");
        mb.append("</table>");
        mb.append("</form>");
    }
%>

<%
    /*----------------------------------------------------*/
/*                  Side Column                       */
    StringBuffer sc = new StringBuffer();
/*----------------------------------------------------*/
%>

<%@ include file="../globalfooter.jsp" %>