<%@ page import="reger.LocationRenderHtml,
                 reger.Location"%>
<%
/*----------------------------------------------------*/
/*                  Page Config                       */
reger.pageFramework.PageProps pageProps = new reger.pageFramework.PageProps();
pageProps.siteSection=pageProps.PUBLICSITE;
pageProps.isPasswordProtected = false;
pageProps.isLogidRequired=false;
pageProps.isEventidRequired=false;
pageProps.trafficType=reger.Vars.TRAFFICTYPEPUBLICMISC;
pageProps.pathToAppRoot="";
/*----------------------------------------------------*/
%>

<%@ include file="globalheader.jsp" %>

<%
/*----------------------------------------------------*/
/*                  Main Body                         */
        StringBuffer mb = new StringBuffer();
/*----------------------------------------------------*/


//Parse the incoming locationid
int locationid=0;
Location loc = null;
if (request.getParameter("locationid")!=null && !request.getParameter("locationid").equals("") && reger.core.Util.isinteger(request.getParameter("locationid"))){
    locationid=Integer.parseInt(request.getParameter("locationid"));
    //@todo Make sure user can view this location
    loc = new Location(locationid);
}



mb.append("<table cellpadding=0 cellspacing=10 width=100% border=0>");
//Location Details
mb.append("<tr>");
mb.append("<td valign=top align=left>");
mb.append("<font face=arial size=+1 class=largefont>");
if (locationid>0){
    mb.append(loc.getLocationname());
} else {
    mb.append("All Locations");
}
mb.append("</font>");
mb.append("<br>");
mb.append("<font face=arial size=-2>");
mb.append("<a href='#entries'>");
mb.append("List Entries for This Location");
mb.append("</a>");
mb.append("</font>");
mb.append("</td>");
mb.append("<td valign=top align=right>");
//List all locations
mb.append("<form action=locations.log method=get>");
mb.append("<font face=arial size=-2>");
mb.append("<b>Choose from All Locations:</b>");
mb.append("</font>");
mb.append("<br>");
mb.append(reger.LocationRenderHtml.getDropdown(reger.Location.getLocationsUserCanView(userSession.getAccountuser(), userSession.getAccount())   , "", locationid, "All Locations", false));
mb.append("<br>");
mb.append("<font face=arial size=-2>");
mb.append("<a href='locations.log'>");
mb.append("View All Locations");
mb.append("</a>");
mb.append("<input type=submit value=Go>");
mb.append("</font>");
mb.append("</form>");
//List all locations
//mb.append("<br>");
mb.append("<form action=locations.log method=get>");
mb.append("<font face=arial size=-2>");
mb.append("<b>Choose from Locations with GPS Coordinates:</b>");
mb.append("</font>");
mb.append("<br>");
mb.append(reger.LocationRenderHtml.getDropdown(reger.Location.getLocationsUserCanView(userSession.getAccountuser(), userSession.getAccount())   , "", locationid, "All Locations", true));
mb.append("<br>");
mb.append("<input type=submit value=Go>");
mb.append("</font>");
mb.append("</form>");
mb.append("</td>");
mb.append("</tr>");
mb.append("</table>");
//Map
mb.append("<table cellpadding=0 cellspacing=10 width=100% border=0>");
mb.append("<tr>");
mb.append("<td valign=top align=center>");
mb.append("<table cellpadding=10 cellspacing=0 bgcolor=#cccccc border=0>");
mb.append("<tr>");
mb.append("<td valign=top align=center>");
if (locationid>0 && loc.getLatitude()==0 && loc.getLongitude()==0){
    mb.append("<font face=arial size=-2>");
    mb.append("<b>This location, "+loc.getLocationname()+", does not have GPS coordinates and is not displayed on the map.</b>");
    mb.append("</font>");
    mb.append("<br><br>");
}
mb.append("<img src=locationmap.log?locationid="+request.getParameter("locationid")+" border=0>");
mb.append("</td>");
mb.append("</tr>");
mb.append("</table>");
mb.append("</td>");
mb.append("<td valign=top align=left>");
if (locationid>0){
    mb.append("<font face=arial size=-2>");
    mb.append(LocationRenderHtml.getSingleLocationAsHtml(loc, false, ""));
    mb.append("</font>");
}
mb.append("</td>");
mb.append("</tr>");
mb.append("</tr>");


mb.append("</table>");





//Now display the entries befitting of our named locationid
mb.append("<a name='entries'>");
mb.append("<br>");
mb.append("<br>");
if (locationid>0){
    mb.append("<font face=arial size=+1 class=largefont>");
    mb.append("Entries for " + loc.getLocationname());
    mb.append("</font>");
} else {
    mb.append("<font face=arial size=+1 class=largefont>");
    mb.append("Entries for All Locations");
    mb.append("</font>");
}
mb.append("<br>");
mb.append("<br>");
mb.append(reger.htmlListEvents.getList(userSession, 0, reger.core.Util.getCurrentPage(request.getParameter("currentpage")), request.getParameter("viewdate"), request.getParameter("viewmonth"), "locations.log", locationid, true, request));



%>

<%
/*----------------------------------------------------*/
/*                  Side Column                       */
        StringBuffer sc = new StringBuffer();
/*----------------------------------------------------*/

//sc.append(reger.SideColumn.favorites(pageProps.logProps.logid, pageProps.logProps.megalogname));

%>

<%@ include file="globalfooter.jsp" %>

