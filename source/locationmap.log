<%
/*----------------------------------------------------*/
/*                  Page Config                       */
reger.pageFramework.PageProps pageProps = new reger.pageFramework.PageProps();
pageProps.siteSection=pageProps.PUBLICSITE;
pageProps.isPasswordProtected = false;
pageProps.trafficType=reger.Vars.TRAFFICTYPEDONTRECORD;
pageProps.pathToAppRoot="";
/*----------------------------------------------------*/
%>

<%
//Done for previews
if (request.getParameter("ispreview")!=null && request.getParameter("ispreview").equals("1")){
    pageProps.siteSection=pageProps.MARKETINGSITE;
}
%>

<%@ include file="globalheader.jsp" %>

<%@ page import="java.io.IOException,
                 reger.core.db.Db,
                 java.awt.*,
                 java.text.DecimalFormat,
                 reger.mega.FieldType,
                 java.awt.image.BufferedImage,
                 reger.geo.MapGenerator,
                 java.util.Properties,
                 com.bbn.openmap.Layer,
                 com.bbn.openmap.util.ComponentFactory,
                 reger.geo.BlogEntryMapLayer,
                 reger.Location" %>
<%@ page import="java.io.OutputStream" %>
<%@ page import="javax.servlet.ServletException" %>
<%@ page import="javax.servlet.http.HttpServlet" %>
<%@ page import="javax.servlet.http.HttpServletRequest" %>
<%@ page import="javax.servlet.http.HttpServletResponse" %>




<%
try {
    //Get locationid
    int locationid=0;
    Location loc = null;
    if (request.getParameter("locationid")!=null && !request.getParameter("locationid").equals("") && reger.core.Util.isinteger(request.getParameter("locationid"))){
        locationid=Integer.parseInt(request.getParameter("locationid"));
        //@todo Make sure user can view this location
        loc = new Location(locationid);
    }

    //Blog layer
    Properties blogLayerProps = new Properties();
    blogLayerProps.put("prettyName", "Blog Layer");
    BlogEntryMapLayer blogLayer = (BlogEntryMapLayer)ComponentFactory.create("reger.geo.BlogEntryMapLayer", blogLayerProps);
    blogLayer.setUserSession(userSession);
    blogLayer.setActiveLocationid(locationid);
    System.out.println("blogLayer created: " + blogLayer.toString());

    //Create the layers array
    Layer[] layers = new Layer[1];
    layers[0]=blogLayer;

    //Create the mapGenerator object
    MapGenerator mapGenerator = new MapGenerator();

    //Output the map
    mapGenerator.drawMap(request, response, layers, null);



} catch (Exception e) {
    reger.core.Util.errorsave(e);
}
%>